+ cd /testbed
+ git config --global --add safe.directory /testbed
+ cd /testbed
+ git status
On branch master
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
	modified:   modules/caddypki/acmeserver/caddyfile.go

no changes added to commit (use "git add" and/or "git commit -a")
+ git diff f6d2c293e752254769efe21c8d06a16ebad4845e
diff --git a/modules/caddypki/acmeserver/caddyfile.go b/modules/caddypki/acmeserver/caddyfile.go
index 7eaaec49..c4d11112 100644
--- a/modules/caddypki/acmeserver/caddyfile.go
+++ b/modules/caddypki/acmeserver/caddyfile.go
@@ -42,6 +42,7 @@ func init() {
 //			domains <domains...>
 //			ip_ranges <addresses...>
 //		}
+//		sign_with_root
 //	}
 func parseACMEServer(h httpcaddyfile.Helper) ([]httpcaddyfile.ConfigValue, error) {
 	h.Next() // consume directive name
@@ -136,6 +137,11 @@ func parseACMEServer(h httpcaddyfile.Helper) ([]httpcaddyfile.ConfigValue, error
 				acmeServer.Policy = &Policy{}
 			}
 			acmeServer.Policy.Deny = r
+		case "sign_with_root":
+			if h.NextArg() {
+				return nil, h.ArgErr()
+			}
+			acmeServer.SignWithRoot = true
 		default:
 			return nil, h.Errf("unrecognized ACME server directive: %s", h.Val())
 		}
+ git checkout f6d2c293e752254769efe21c8d06a16ebad4845e
Note: switching to 'f6d2c293e752254769efe21c8d06a16ebad4845e'.

You are in 'detached HEAD' state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by switching back to a branch.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -c with the switch command. Example:

  git switch -c <new-branch-name>

Or undo this operation with:

  git switch -

Turn off this advice by setting config variable advice.detachedHead to false

HEAD is now at f6d2c293 caddyfile: Reject global request matchers earlier (#6339)
M	modules/caddypki/acmeserver/caddyfile.go
+ git apply -v -
Checking patch caddytest/integration/caddyfile_adapt/acme_server_sign_with_root.caddyfiletest...
Applied patch caddytest/integration/caddyfile_adapt/acme_server_sign_with_root.caddyfiletest cleanly.
+ go test -v ./caddytest/integration
=== RUN   TestACMEServerWithDefaults
{"level":"info","ts":1728043323.5549622,"msg":"using config from file","file":"/tmp/1753159158"}
{"level":"info","ts":1728043323.5558634,"msg":"adapted config to JSON","adapter":"caddyfile"}
{"level":"info","ts":1728043323.556528,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043323.5568123,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043323.5568306,"msg":"serving initial configuration"}
{"level":"info","ts":1728043324.55782,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39268","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043324.5595598,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39280","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043324.5622358,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39292","headers":{"Accept-Encoding":["gzip"],"Content-Length":["144"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043324.5681639,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043324.5757794,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043324.575839,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043324.5759044,"logger":"tls.cache.maintenance","msg":"started background certificate maintenance","cache":"0xc000706400"}
{"level":"info","ts":1728043324.6063356,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043324.6065392,"msg":"failed to sufficiently increase receive buffer size (was: 208 kiB, wanted: 7168 kiB, got: 416 kiB). See https://github.com/quic-go/quic-go/wiki/UDP-Buffer-Sizes for details."}
{"level":"info","ts":1728043324.6067328,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043324.6068034,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043324.6068096,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["acme.localhost"]}
{"level":"info","ts":1728043324.60688,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043324.6070218,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043324.607036,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043324.607199,"msg":"caddytest: config load time took 46.837482ms"}
{"level":"info","ts":1728043324.6078503,"logger":"tls.obtain","msg":"acquiring lock","identifier":"acme.localhost"}
{"level":"info","ts":1728043324.6089454,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39302","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043324.6090243,"logger":"tls.obtain","msg":"lock acquired","identifier":"acme.localhost"}
{"level":"info","ts":1728043324.6090453,"logger":"tls","msg":"cleaning storage unit","storage":"FileStorage:/root/.local/share/caddy"}
{"level":"info","ts":1728043324.6091287,"logger":"tls.obtain","msg":"obtaining certificate","identifier":"acme.localhost"}
{"level":"info","ts":1728043324.609301,"logger":"tls","msg":"finished cleaning storage units"}
{"level":"info","ts":1728043324.609568,"msg":"caddytest: redirecting the dialer from acme.localhost:9443 to 127.0.0.1:9443"}
{"level":"info","ts":1728043324.6110516,"logger":"tls.obtain","msg":"certificate obtained successfully","identifier":"acme.localhost","issuer":"local"}
2024-10-04T12:02:04.610Z	WARN	acme/http.go:179	HTTP request failed; retrying	{"url": "https://acme.localhost:9443/acme/local/directory", "error": "performing request: Get \"https://acme.localhost:9443/acme/local/directory\": remote error: tls: internal error"}
github.com/mholt/acmez/v2/acme.(*Client).httpReq
	/go/pkg/mod/github.com/mholt/acmez/v2@v2.0.1/acme/http.go:179
github.com/mholt/acmez/v2/acme.(*Client).provisionDirectory
	/go/pkg/mod/github.com/mholt/acmez/v2@v2.0.1/acme/client.go:125
github.com/mholt/acmez/v2/acme.(*Client).provision
	/go/pkg/mod/github.com/mholt/acmez/v2@v2.0.1/acme/client.go:99
github.com/mholt/acmez/v2/acme.(*Client).NewAccount
	/go/pkg/mod/github.com/mholt/acmez/v2@v2.0.1/acme/account.go:113
github.com/caddyserver/caddy/v2/caddytest/integration.TestACMEServerWithDefaults
	/testbed/caddytest/integration/acme_test.go:67
testing.tRunner
	/usr/local/go/src/testing/testing.go:1690
{"level":"info","ts":1728043324.6112108,"logger":"tls.obtain","msg":"releasing lock","identifier":"acme.localhost"}
{"level":"warn","ts":1728043324.6117575,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [acme.localhost]: no OCSP server specified in certificate","identifiers":["acme.localhost"]}
{"level":"info","ts":1728043324.6381755,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043324.8619637,"msg":"caddytest: redirecting the dialer from acme.localhost:9443 to 127.0.0.1:9443"}
2024-10-04T12:02:04.868Z	DEBUG	acme/http.go:275	http request	{"method": "GET", "url": "https://acme.localhost:9443/acme/local/directory", "headers": {"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Content-Length":["322"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:04 GMT"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:04.870Z	DEBUG	acme/http.go:275	http request	{"method": "HEAD", "url": "https://acme.localhost:9443/acme/local/new-nonce", "headers": {"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Date":["Fri, 04 Oct 2024 12:02:04 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Replay-Nonce":["YkdmZHVnbWp3S3R6ZkxSbUxtV1VSbHdCRWdxM0J2c04"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:04.877Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/new-account", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["154"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:04 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/account/DYgB5UU7klaxWxPUD9qazr9mfLo1rHIg"],"Replay-Nonce":["c1dqMjM4dm55UThJdWQxNE53TXM2YUJEV3h4U09sanI"],"Server":["Caddy"]}, "status_code": 201}
2024-10-04T12:02:04.878Z	DEBUG	acme/order.go:130	creating order	{"account": "https://acme.localhost:9443/acme/local/account/DYgB5UU7klaxWxPUD9qazr9mfLo1rHIg", "identifiers": ["localhost"]}
2024-10-04T12:02:04.894Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/new-order", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["413"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:04 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/order/bQXi4P2cuReveU2jZViw1xr8VIKjbGfB"],"Replay-Nonce":["YWtrUFIzcnFEdjgxYWkwTWRyRng4WHlsczlIR25pd1g"],"Server":["Caddy"]}, "status_code": 201}
2024-10-04T12:02:04.900Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/authz/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["749"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:04 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/authz/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn"],"Replay-Nonce":["RHY3b3Y5djIwMUhSbzUyRDZVNWhFamVucUdDTHVFS3c"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:04.901Z	INFO	v2@v2.0.1/client.go:404	trying to solve challenge	{"identifier": "localhost", "challenge_type": "http-01", "ca": "https://acme.localhost:9443/acme/local/directory"}
2024-10-04T12:02:04.901Z	INFO	integration/acme_test.go:194	present challenge	{"challenge": {"type":"http-01","url":"https://acme.localhost:9443/acme/local/challenge/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn/8k56RBQwLHEUAtKYSZQE7hSdtjNrZGOf","status":"pending","token":"PtB2PPpXHdno9Hc9G7AQa5DKXSyQ1heI","keyAuthorization":"PtB2PPpXHdno9Hc9G7AQa5DKXSyQ1heI.o78k5GW4CFutEwHmJaPXTzETYYf3n6U60sAI_QcFPX0","identifier":{"type":"dns","value":"localhost"}}}
2024-10-04T12:02:04.907Z	INFO	integration/acme_test.go:177	received request on challenge server	{"path": "/.well-known/acme-challenge/PtB2PPpXHdno9Hc9G7AQa5DKXSyQ1heI"}
2024-10-04T12:02:04.907Z	INFO	integration/acme_test.go:182	served key authentication	{"identifier": "localhost", "challenge": "http-01", "remote": "[::1]:45060"}
2024-10-04T12:02:04.909Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/challenge/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn/8k56RBQwLHEUAtKYSZQE7hSdtjNrZGOf", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["237"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:04 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\"","<https://acme.localhost:9443/acme/local/authz/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn>;rel=\"up\""],"Location":["https://acme.localhost:9443/acme/local/challenge/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn/8k56RBQwLHEUAtKYSZQE7hSdtjNrZGOf"],"Replay-Nonce":["bGtkRHBHcUk5d0FoSXMwOXhsRlo3djhqTVN3ZnQ1akM"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:04.909Z	DEBUG	v2@v2.0.1/client.go:478	challenge accepted	{"identifier": "localhost", "challenge_type": "http-01"}
2024-10-04T12:02:05.168Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/authz/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["780"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/authz/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn"],"Replay-Nonce":["UHRRdktLV3BvSzJ6Nnl3TzgzN01Rck9kVjJid1JoV0o"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.168Z	INFO	integration/acme_test.go:201	cleanup	{"challenge": {"type":"http-01","url":"https://acme.localhost:9443/acme/local/challenge/WCRpsyqgVWLU6r02827F7hx6cbNzOQMn/8k56RBQwLHEUAtKYSZQE7hSdtjNrZGOf","status":"valid","validated":"2024-10-04T12:02:04Z","token":"PtB2PPpXHdno9Hc9G7AQa5DKXSyQ1heI","keyAuthorization":"PtB2PPpXHdno9Hc9G7AQa5DKXSyQ1heI.o78k5GW4CFutEwHmJaPXTzETYYf3n6U60sAI_QcFPX0","identifier":{"type":"dns","value":"localhost"}}}
2024-10-04T12:02:05.169Z	INFO	v2@v2.0.1/client.go:581	authorization finalized	{"identifier": "localhost", "authz_status": "valid"}
2024-10-04T12:02:05.169Z	INFO	v2@v2.0.1/client.go:173	validations succeeded; finalizing order	{"order": "https://acme.localhost:9443/acme/local/order/bQXi4P2cuReveU2jZViw1xr8VIKjbGfB"}
2024-10-04T12:02:05.182Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/order/bQXi4P2cuReveU2jZViw1xr8VIKjbGfB/finalize", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["511"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/order/bQXi4P2cuReveU2jZViw1xr8VIKjbGfB"],"Replay-Nonce":["WWszeUdxczUyY1NDSHk1eGZWVWJ0a3ZKMlNpNkZSNGE"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.187Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/certificate/Ogme9yIsrv6lIuPRNBuG0uc6s77WjNC9", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["1384"],"Content-Type":["application/pem-certificate-chain"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Replay-Nonce":["cjZ3d2phWVp3Z0cyaURYejk1VzBjVEExdTRzWlVsVTM"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.188Z	INFO	v2@v2.0.1/client.go:207	successfully downloaded available certificate chains	{"count": 1, "first_url": "https://acme.localhost:9443/acme/local/certificate/Ogme9yIsrv6lIuPRNBuG0uc6s77WjNC9"}
    acme_test.go:92: Certificate "https://acme.localhost:9443/acme/local/certificate/Ogme9yIsrv6lIuPRNBuG0uc6s77WjNC9":
        -----BEGIN CERTIFICATE-----
        MIIB3DCCAYOgAwIBAgIQJBEmeTpeuuM2+hnkVjA6ODAKBggqhkjOPQQDAjAzMTEw
        LwYDVQQDEyhDYWRkeSBMb2NhbCBBdXRob3JpdHkgLSBFQ0MgSW50ZXJtZWRpYXRl
        MB4XDTI0MTAwNDEyMDEwNFoXDTI0MTAwNTAwMDIwNFowADBZMBMGByqGSM49AgEG
        CCqGSM49AwEHA0IABJtttGJQglM3I35VRTZvEa+ctnBYw3t65YSCMoxygGnd8kXi
        FLhDiXVDRN5e7VTwsJkKmdESOpslekBGveHnY9KjgaswgagwDgYDVR0PAQH/BAQD
        AgeAMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAdBgNVHQ4EFgQUtfWp
        y1LTfrkrVGeeFQdE/RFzhdEwHwYDVR0jBBgwFoAUWmNiHmLE+ZBQB3xGF+920G2s
        ZfswFwYDVR0RAQH/BA0wC4IJbG9jYWxob3N0MB4GDCsGAQQBgqRkxihAAQQOMAwC
        AQYEBWxvY2FsBAAwCgYIKoZIzj0EAwIDRwAwRAIgadqEZkENZnp4wnWAQdbJzE/j
        W/Rdsxzi7gd+Vr7Q/xcCICeK603SvrbwFbtbpZ2u2Fawa+1zWXP404bxkDaYIeM2
        -----END CERTIFICATE-----
        -----BEGIN CERTIFICATE-----
        MIIByTCCAW6gAwIBAgIRANeObEtClT+Xa1Py5LvvlCAwCgYIKoZIzj0EAwIwMDEu
        MCwGA1UEAxMlQ2FkZHkgTG9jYWwgQXV0aG9yaXR5IC0gMjAyNCBFQ0MgUm9vdDAe
        Fw0yNDEwMDQxMjAyMDRaFw0yNDEwMTExMjAyMDRaMDMxMTAvBgNVBAMTKENhZGR5
        IExvY2FsIEF1dGhvcml0eSAtIEVDQyBJbnRlcm1lZGlhdGUwWTATBgcqhkjOPQIB
        BggqhkjOPQMBBwNCAAQ6TyuLnD1adD1R1q2U3UR+xO4/m7nRnP6yseeK1pIQJWQZ
        mzajVGUidAAqqIL5GZb5gki7vDkgl+CasT4GqRM0o2YwZDAOBgNVHQ8BAf8EBAMC
        AQYwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUWmNiHmLE+ZBQB3xGF+92
        0G2sZfswHwYDVR0jBBgwFoAUMBEcn0gRQdZv1nkIkJfOgi2kJ8MwCgYIKoZIzj0E
        AwIDSQAwRgIhAK6MeDmqB6IOOFtHMVczWUWTsFR9wgDjLq7d7S4CJZD0AiEAltFl
        wh0A/sCra0weJYI063E8+swMR8oXS8HmTGXWgTM=
        -----END CERTIFICATE-----
        
        
--- PASS: TestACMEServerWithDefaults (1.64s)
=== RUN   TestACMEServerWithMismatchedChallenges
{"level":"info","ts":1728043325.1892068,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39302","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.190801,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39306","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.1919343,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39318","headers":{"Accept-Encoding":["gzip"],"Content-Length":["176"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.193806,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043325.1948848,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043325.1949186,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043325.2102764,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.210446,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.210499,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.2105825,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.210589,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["acme.localhost"]}
{"level":"info","ts":1728043325.210627,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.2112396,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.2112975,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.2115726,"msg":"caddytest: config load time took 20.392129ms"}
{"level":"info","ts":1728043325.2131853,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39328","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.2138226,"msg":"caddytest: redirecting the dialer from acme.localhost:9443 to 127.0.0.1:9443"}
{"level":"info","ts":1728043325.2293775,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"error","ts":1728043325.2426074,"logger":"acmez","msg":"deactivating authorization","identifier":"localhost","authz":"https://acme.localhost:9443/acme/local/authz/EhkzWcRPXSmppzDdFyL1JwKuQWI7C9Bw","error":"attempt 1: https://acme.localhost:9443/acme/local/authz/EhkzWcRPXSmppzDdFyL1JwKuQWI7C9Bw: HTTP 400 urn:ietf:params:acme:error:malformed - The request message was malformed"}
--- PASS: TestACMEServerWithMismatchedChallenges (0.05s)
=== RUN   TestACMEServerDirectory
{"level":"info","ts":1728043325.2430198,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39328","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.2441933,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39342","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.2456453,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39344","headers":{"Accept-Encoding":["gzip"],"Content-Length":["213"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.249849,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043325.2506316,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043325.2506676,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043325.2633843,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.2637517,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.2638302,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.2639275,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.2639472,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["acme.localhost"]}
{"level":"info","ts":1728043325.2639747,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.264449,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.264526,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.2647393,"msg":"caddytest: config load time took 20.058098ms"}
{"level":"info","ts":1728043325.266496,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39356","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.2670631,"msg":"caddytest: redirecting the dialer from acme.localhost:9443 to 127.0.0.1:9443"}
{"level":"info","ts":1728043325.2671888,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
--- PASS: TestACMEServerDirectory (0.03s)
=== RUN   TestACMEServerAllowPolicy
{"level":"info","ts":1728043325.2698076,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39356","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.271197,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39364","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.272385,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39376","headers":{"Accept-Encoding":["gzip"],"Content-Length":["274"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.273793,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"info","ts":1728043325.2744732,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043325.2745354,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043325.2879763,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.2881591,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.288197,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.28825,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.2882624,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["acme.localhost"]}
{"level":"info","ts":1728043325.2882807,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.2886696,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.2886925,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.288919,"msg":"caddytest: config load time took 17.396157ms"}
{"level":"info","ts":1728043325.2900043,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.290662,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39378","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.2913911,"msg":"caddytest: redirecting the dialer from acme.localhost:9443 to 127.0.0.1:9443"}
2024-10-04T12:02:05.295Z	DEBUG	acme/http.go:275	http request	{"method": "HEAD", "url": "https://acme.localhost:9443/acme/local/new-nonce", "headers": {"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Replay-Nonce":["WE1nend0V1VBMmtRN2UyZjI5dXBCOXNHUERqbGpQMmg"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.302Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/new-account", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["154"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/account/WuJafChLdcGU19C3Nj9oDdE6dhs9g28q"],"Replay-Nonce":["cXpEYk9MamxYQTJwdzhMM1Y2Vm5BQmE1WHZSMDdJY2M"],"Server":["Caddy"]}, "status_code": 201}
2024-10-04T12:02:05.303Z	DEBUG	acme/order.go:130	creating order	{"account": "https://acme.localhost:9443/acme/local/account/WuJafChLdcGU19C3Nj9oDdE6dhs9g28q", "identifiers": ["localhost"]}
2024-10-04T12:02:05.314Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/new-order", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["413"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/order/FE7VB6DeQLx1oWKfb8vEPo5jOotO9yra"],"Replay-Nonce":["aXpxSzNRMTUxcE5YaUpqQ0pucUdoU1Vpbk43OFQwekE"],"Server":["Caddy"]}, "status_code": 201}
2024-10-04T12:02:05.318Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/authz/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["338"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/authz/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy"],"Replay-Nonce":["aE1aaWdZNTJaU0dDQkhTUEN3ZFZGRG1Icm9xTGt6TFE"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.318Z	INFO	v2@v2.0.1/client.go:404	trying to solve challenge	{"identifier": "localhost", "challenge_type": "http-01", "ca": "https://acme.localhost:9443/acme/local/directory"}
2024-10-04T12:02:05.318Z	INFO	integration/acme_test.go:194	present challenge	{"challenge": {"type":"http-01","url":"https://acme.localhost:9443/acme/local/challenge/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy/Dxz7TkJtHvZNcGYW2vDu0qmc21pwyW5s","status":"pending","token":"LKiPRi6LlPzGbrymac3HlmuRXBZF5VCA","keyAuthorization":"LKiPRi6LlPzGbrymac3HlmuRXBZF5VCA.hePJuNG1PDbblKQskUol14T5JUMGyI423Hpg5_mQIik","identifier":{"type":"dns","value":"localhost"}}}
2024-10-04T12:02:05.322Z	INFO	integration/acme_test.go:177	received request on challenge server	{"path": "/.well-known/acme-challenge/LKiPRi6LlPzGbrymac3HlmuRXBZF5VCA"}
2024-10-04T12:02:05.322Z	INFO	integration/acme_test.go:182	served key authentication	{"identifier": "localhost", "challenge": "http-01", "remote": "[::1]:45062"}
2024-10-04T12:02:05.325Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/challenge/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy/Dxz7TkJtHvZNcGYW2vDu0qmc21pwyW5s", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["237"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\"","<https://acme.localhost:9443/acme/local/authz/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy>;rel=\"up\""],"Location":["https://acme.localhost:9443/acme/local/challenge/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy/Dxz7TkJtHvZNcGYW2vDu0qmc21pwyW5s"],"Replay-Nonce":["cGZmUFEzeElEQ0phb1lKcHlpZ1IxaHdYNjdpdFJrR1Y"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.325Z	DEBUG	v2@v2.0.1/client.go:478	challenge accepted	{"identifier": "localhost", "challenge_type": "http-01"}
2024-10-04T12:02:05.582Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/authz/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["369"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/authz/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy"],"Replay-Nonce":["YUlhb0FmRWpLaU5GM1Z1d0F1V3BxMXhXcGRZaVhwbzE"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.582Z	INFO	integration/acme_test.go:201	cleanup	{"challenge": {"type":"http-01","url":"https://acme.localhost:9443/acme/local/challenge/3nCEGsc95DkSi5pGc0KSEBafmHxsH8Vy/Dxz7TkJtHvZNcGYW2vDu0qmc21pwyW5s","status":"valid","validated":"2024-10-04T12:02:05Z","token":"LKiPRi6LlPzGbrymac3HlmuRXBZF5VCA","keyAuthorization":"LKiPRi6LlPzGbrymac3HlmuRXBZF5VCA.hePJuNG1PDbblKQskUol14T5JUMGyI423Hpg5_mQIik","identifier":{"type":"dns","value":"localhost"}}}
2024-10-04T12:02:05.583Z	INFO	v2@v2.0.1/client.go:581	authorization finalized	{"identifier": "localhost", "authz_status": "valid"}
2024-10-04T12:02:05.583Z	INFO	v2@v2.0.1/client.go:173	validations succeeded; finalizing order	{"order": "https://acme.localhost:9443/acme/local/order/FE7VB6DeQLx1oWKfb8vEPo5jOotO9yra"}
2024-10-04T12:02:05.596Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/order/FE7VB6DeQLx1oWKfb8vEPo5jOotO9yra/finalize", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["511"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/order/FE7VB6DeQLx1oWKfb8vEPo5jOotO9yra"],"Replay-Nonce":["dFRsN0dteElvZHFaUVNGbDBKaUdlNzYwTDB0QnhFSm0"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.599Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/certificate/2FzaCBhF27CXnaAfPHifha8ffWL3ZJ6j", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["1389"],"Content-Type":["application/pem-certificate-chain"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Replay-Nonce":["OFVGTkxHa2FWQVN6bGd5M2cxWGplY2pjUjJERHZkRjY"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.599Z	INFO	v2@v2.0.1/client.go:207	successfully downloaded available certificate chains	{"count": 1, "first_url": "https://acme.localhost:9443/acme/local/certificate/2FzaCBhF27CXnaAfPHifha8ffWL3ZJ6j"}
    acmeserver_test.go:120: Certificate "https://acme.localhost:9443/acme/local/certificate/2FzaCBhF27CXnaAfPHifha8ffWL3ZJ6j":
        -----BEGIN CERTIFICATE-----
        MIIB3jCCAYSgAwIBAgIRAM0iMgsWK8RvT9Ogz7bmdjcwCgYIKoZIzj0EAwIwMzEx
        MC8GA1UEAxMoQ2FkZHkgTG9jYWwgQXV0aG9yaXR5IC0gRUNDIEludGVybWVkaWF0
        ZTAeFw0yNDEwMDQxMjAxMDVaFw0yNDEwMDUwMDAyMDVaMAAwWTATBgcqhkjOPQIB
        BggqhkjOPQMBBwNCAAT3m3+H5qQjEPix7oVNA2YUBw1lZeRnfa3JDP5lsRN2NIvY
        dw58+Upwo54gjnhi9H6eU4e7GES+lNbPlYP1cVxNo4GrMIGoMA4GA1UdDwEB/wQE
        AwIHgDAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwHQYDVR0OBBYEFCVV
        3snklAtWx2K6RXxADRCDoLpQMB8GA1UdIwQYMBaAFFpjYh5ixPmQUAd8RhfvdtBt
        rGX7MBcGA1UdEQEB/wQNMAuCCWxvY2FsaG9zdDAeBgwrBgEEAYKkZMYoQAEEDjAM
        AgEGBAVsb2NhbAQAMAoGCCqGSM49BAMCA0gAMEUCIQC1FaxuCHmsTUKP8lQb/zRu
        rRkovqX1cxjW3EdwjtBWgwIgO30e780avlhHTrYBxoG15RNo2YtHwuR7kEtGTBXf
        09A=
        -----END CERTIFICATE-----
        -----BEGIN CERTIFICATE-----
        MIIByTCCAW6gAwIBAgIRANeObEtClT+Xa1Py5LvvlCAwCgYIKoZIzj0EAwIwMDEu
        MCwGA1UEAxMlQ2FkZHkgTG9jYWwgQXV0aG9yaXR5IC0gMjAyNCBFQ0MgUm9vdDAe
        Fw0yNDEwMDQxMjAyMDRaFw0yNDEwMTExMjAyMDRaMDMxMTAvBgNVBAMTKENhZGR5
        IExvY2FsIEF1dGhvcml0eSAtIEVDQyBJbnRlcm1lZGlhdGUwWTATBgcqhkjOPQIB
        BggqhkjOPQMBBwNCAAQ6TyuLnD1adD1R1q2U3UR+xO4/m7nRnP6yseeK1pIQJWQZ
        mzajVGUidAAqqIL5GZb5gki7vDkgl+CasT4GqRM0o2YwZDAOBgNVHQ8BAf8EBAMC
        AQYwEgYDVR0TAQH/BAgwBgEB/wIBADAdBgNVHQ4EFgQUWmNiHmLE+ZBQB3xGF+92
        0G2sZfswHwYDVR0jBBgwFoAUMBEcn0gRQdZv1nkIkJfOgi2kJ8MwCgYIKoZIzj0E
        AwIDSQAwRgIhAK6MeDmqB6IOOFtHMVczWUWTsFR9wgDjLq7d7S4CJZD0AiEAltFl
        wh0A/sCra0weJYI063E8+swMR8oXS8HmTGXWgTM=
        -----END CERTIFICATE-----
        
        
2024-10-04T12:02:05.599Z	DEBUG	acme/order.go:130	creating order	{"account": "https://acme.localhost:9443/acme/local/account/WuJafChLdcGU19C3Nj9oDdE6dhs9g28q", "identifiers": ["not-matching.localhost"]}
2024-10-04T12:02:05.603Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/new-order", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["126"],"Content-Type":["application/problem+json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Replay-Nonce":["ejNBVEVpRk1RMG9mUk1ZUmpiWTJPNlNJaXB5bjg3TTU"],"Server":["Caddy"]}, "status_code": 400}
--- PASS: TestACMEServerAllowPolicy (0.33s)
=== RUN   TestACMEServerDenyPolicy
{"level":"info","ts":1728043325.6044526,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39378","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6056612,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39380","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6073012,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39396","headers":{"Accept-Encoding":["gzip"],"Content-Length":["256"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.608738,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043325.609446,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043325.6094701,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043325.6197815,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.6198463,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.619909,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6199214,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["acme.localhost"]}
{"level":"info","ts":1728043325.6199338,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.6199543,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.6202364,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.6202607,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.6204278,"msg":"caddytest: config load time took 14.327074ms"}
{"level":"info","ts":1728043325.623415,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39406","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6241622,"msg":"caddytest: redirecting the dialer from acme.localhost:9443 to 127.0.0.1:9443"}
{"level":"info","ts":1728043325.6272957,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
2024-10-04T12:02:05.627Z	DEBUG	acme/http.go:275	http request	{"method": "HEAD", "url": "https://acme.localhost:9443/acme/local/new-nonce", "headers": {"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Replay-Nonce":["bVBrZUI2N1lrNEdVQnlPYlNLOFRKbUJraGVoOGh2YzA"],"Server":["Caddy"]}, "status_code": 200}
2024-10-04T12:02:05.633Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/new-account", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["154"],"Content-Type":["application/json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Location":["https://acme.localhost:9443/acme/local/account/4Iqsw9qE850h5fN8S28OKWx4GyQgrp1D"],"Replay-Nonce":["djdHTWtGTU5YZDFuSWdhOHIzZ0V4M3pzV2x3VzVPdzQ"],"Server":["Caddy"]}, "status_code": 201}
2024-10-04T12:02:05.634Z	DEBUG	acme/order.go:130	creating order	{"account": "https://acme.localhost:9443/acme/local/account/4Iqsw9qE850h5fN8S28OKWx4GyQgrp1D", "identifiers": ["deny.localhost"]}
2024-10-04T12:02:05.637Z	DEBUG	acme/http.go:275	http request	{"method": "POST", "url": "https://acme.localhost:9443/acme/local/new-order", "headers": {"Content-Type":["application/jose+json"],"User-Agent":["acmez (linux; amd64)"]}, "response_headers": {"Alt-Svc":["h3=\":9443\"; ma=2592000"],"Cache-Control":["no-store"],"Content-Length":["126"],"Content-Type":["application/problem+json"],"Date":["Fri, 04 Oct 2024 12:02:05 GMT"],"Link":["<https://acme.localhost:9443/acme/local/directory>;rel=\"index\""],"Replay-Nonce":["UFRRb1c5ZzhkbVZyR2tsbHhqTDMwR1lLelc3QnNKeWE"],"Server":["Caddy"]}, "status_code": 400}
--- PASS: TestACMEServerDenyPolicy (0.03s)
=== RUN   TestAutoHTTPtoHTTPSRedirectsImplicitPort
{"level":"info","ts":1728043325.637956,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39406","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.638969,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39414","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6400468,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39424","headers":{"Accept-Encoding":["gzip"],"Content-Length":["139"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.641279,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043325.6414084,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043325.6414328,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043325.6421304,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.6422026,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.6422265,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6422646,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6422694,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["localhost"]}
{"level":"info","ts":1728043325.64233,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.6427956,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.6428156,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.642864,"logger":"tls.obtain","msg":"acquiring lock","identifier":"localhost"}
{"level":"info","ts":1728043325.6429422,"msg":"caddytest: config load time took 3.570514ms"}
{"level":"info","ts":1728043325.64417,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39436","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6444714,"logger":"tls.obtain","msg":"lock acquired","identifier":"localhost"}
{"level":"info","ts":1728043325.644503,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043325.6446216,"logger":"tls.obtain","msg":"obtaining certificate","identifier":"localhost"}
{"level":"info","ts":1728043325.644802,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
--- PASS: TestAutoHTTPtoHTTPSRedirectsImplicitPort (0.01s)
=== RUN   TestAutoHTTPtoHTTPSRedirectsExplicitPortSameAsHTTPSPort
{"level":"info","ts":1728043325.645556,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39436","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6464822,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39450","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6472232,"logger":"tls.obtain","msg":"certificate obtained successfully","identifier":"localhost","issuer":"local"}
{"level":"info","ts":1728043325.6474257,"logger":"tls.obtain","msg":"releasing lock","identifier":"localhost"}
{"level":"info","ts":1728043325.6475494,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39458","headers":{"Accept-Encoding":["gzip"],"Content-Length":["144"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6480145,"msg":"config is unchanged"}
{"level":"info","ts":1728043325.6480289,"logger":"admin.api","msg":"load complete"}
{"level":"warn","ts":1728043325.6481006,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [localhost]: no OCSP server specified in certificate","identifiers":["localhost"]}
{"level":"info","ts":1728043325.6481435,"msg":"caddytest: config load time took 1.206153ms"}
{"level":"info","ts":1728043325.648779,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39458","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6491086,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestAutoHTTPtoHTTPSRedirectsExplicitPortSameAsHTTPSPort (0.00s)
=== RUN   TestAutoHTTPtoHTTPSRedirectsExplicitPortDifferentFromHTTPSPort
{"level":"info","ts":1728043325.6501153,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39458","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6510546,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39466","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6520536,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39478","headers":{"Accept-Encoding":["gzip"],"Content-Length":["144"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6531177,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"info","ts":1728043325.6532598,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043325.6539943,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.6541028,"logger":"http","msg":"enabling HTTP/3 listener","addr":":1234"}
{"level":"info","ts":1728043325.6544592,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6545613,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.654575,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["localhost"]}
{"level":"info","ts":1728043325.6546183,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.654918,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.6549368,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.6550438,"msg":"caddytest: config load time took 3.709697ms"}
{"level":"info","ts":1728043325.6560922,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39488","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.656466,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043325.6566854,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
--- PASS: TestAutoHTTPtoHTTPSRedirectsExplicitPortDifferentFromHTTPSPort (0.01s)
=== RUN   TestAutoHTTPRedirectsWithHTTPListenerFirstInAddresses
{"level":"info","ts":1728043325.657174,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39488","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.657962,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39498","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
        {
          "admin": {
        	"listen": "localhost:2999"
          },
          "apps": {
            "http": {
              "http_port": 9080,
              "https_port": 9443,
              "servers": {
                "ingress_server": {
                  "listen": [
                    ":9080",
                    ":9443"
                  ],
                  "routes": [
                    {
                      "match": [
                        {
        				  "host": ["localhost"]
                        }
                      ]
                    }
                  ]
                }
              }
            },
        	"pki": {
        		"certificate_authorities": {
        			"local": {
        				"install_trust": false
        			}
        		}
        	}
          }
        }
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"http_port":9080,"https_port":9443,"servers":{"ingress_server":{"listen":[":9080",":9443"],"routes":[{"match":[{"host":["localhost"]}]}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}}}}
{"level":"info","ts":1728043325.659062,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39508","headers":{"Accept-Encoding":["gzip"],"Content-Length":["262"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.659678,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"info","ts":1728043325.659787,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"ingress_server"}
{"level":"info","ts":1728043325.6604064,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.6605422,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.6609142,"logger":"http.log","msg":"server running","name":"ingress_server","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6609309,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["localhost"]}
{"level":"info","ts":1728043325.6609447,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.6612406,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.6612554,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.6614082,"msg":"caddytest: config load time took 2.925664ms"}
{"level":"info","ts":1728043325.6620398,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39514","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6623433,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestAutoHTTPRedirectsWithHTTPListenerFirstInAddresses (0.01s)
=== RUN   TestAutoHTTPRedirectsInsertedBeforeUserDefinedCatchAll
{"level":"info","ts":1728043325.663043,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39514","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6635325,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.6636455,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39528","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6645067,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39530","headers":{"Accept-Encoding":["gzip"],"Content-Length":["228"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6659436,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.6669157,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.6669476,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv1","https_port":9443}
{"level":"info","ts":1728043325.6669595,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv1"}
{"level":"info","ts":1728043325.6671865,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.6672904,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6673458,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.667363,"logger":"http.log","msg":"server running","name":"srv1","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6673682,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["bar.localhost"]}
{"level":"info","ts":1728043325.6674578,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.667835,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.6678536,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.6680863,"msg":"caddytest: config load time took 4.161622ms"}
{"level":"info","ts":1728043325.6683505,"logger":"tls.obtain","msg":"acquiring lock","identifier":"bar.localhost"}
{"level":"info","ts":1728043325.6693318,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.669659,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39540","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6701648,"msg":"caddytest: redirecting the dialer from bar.localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043325.6702332,"logger":"tls.obtain","msg":"lock acquired","identifier":"bar.localhost"}
{"level":"info","ts":1728043325.6703832,"logger":"tls.obtain","msg":"obtaining certificate","identifier":"bar.localhost"}
{"level":"info","ts":1728043325.6709988,"msg":"caddytest: redirecting the dialer from foo.localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043325.6716795,"msg":"caddytest: redirecting the dialer from baz.localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043325.6723075,"logger":"tls.obtain","msg":"certificate obtained successfully","identifier":"bar.localhost","issuer":"local"}
--- PASS: TestAutoHTTPRedirectsInsertedBeforeUserDefinedCatchAll (0.01s)
{"level":"info","ts":1728043325.6725178,"logger":"tls.obtain","msg":"releasing lock","identifier":"bar.localhost"}
=== RUN   TestAutoHTTPRedirectsInsertedBeforeUserDefinedCatchAllWithNoExplicitHTTPSite
{"level":"info","ts":1728043325.6729116,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39540","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"warn","ts":1728043325.6731932,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [bar.localhost]: no OCSP server specified in certificate","identifiers":["bar.localhost"]}
{"level":"info","ts":1728043325.6741984,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39554","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6755583,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39564","headers":{"Accept-Encoding":["gzip"],"Content-Length":["180"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6769457,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.677971,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.6780453,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv1","https_port":9443}
{"level":"info","ts":1728043325.6780627,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv1"}
{"level":"info","ts":1728043325.6782742,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.6783793,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6784396,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043325.6784606,"logger":"http.log","msg":"server running","name":"srv1","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.6784747,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["bar.localhost"]}
{"level":"info","ts":1728043325.6784904,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.6790195,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.6790433,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.6792128,"msg":"caddytest: config load time took 4.466682ms"}
{"level":"info","ts":1728043325.6805556,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.6807003,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39580","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.6836824,"msg":"caddytest: redirecting the dialer from bar.localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043325.6847053,"msg":"caddytest: redirecting the dialer from foo.localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043325.6852121,"msg":"caddytest: redirecting the dialer from baz.localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestAutoHTTPRedirectsInsertedBeforeUserDefinedCatchAllWithNoExplicitHTTPSite (0.01s)
=== RUN   TestCaddyfileAdaptToJSON
    caddytest.go:415: warning: acme_server_sign_with_root.caddyfiletest:8: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: heredoc.caddyfiletest:2: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: map_and_vars_with_raw_types.caddyfiletest:3: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
{"level":"warn","ts":1728043325.8200238,"msg":"The 'trusted_ca_cert_file' field is deprecated. Use the 'trust_pool' field instead."}
{"level":"warn","ts":1728043325.8208752,"msg":"The 'trusted_ca_cert_file' field is deprecated. Use the 'trust_pool' field instead."}
{"level":"warn","ts":1728043325.8222911,"msg":"The 'trusted_ca_cert' field is deprecated. Use the 'trust_pool' field instead."}
--- PASS: TestCaddyfileAdaptToJSON (0.14s)
=== RUN   TestRespond
{"level":"info","ts":1728043325.8302007,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39580","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.831213,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39594","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8321245,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39602","headers":{"Accept-Encoding":["gzip"],"Content-Length":["201"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8331323,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//[::1]:2999","//127.0.0.1:2999","//localhost:2999"]}
{"level":"warn","ts":1728043325.8332617,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.8334153,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.8334305,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.8337808,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.8337975,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.8338928,"msg":"caddytest: config load time took 2.377537ms"}
{"level":"info","ts":1728043325.8347464,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.8352928,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39616","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8357146,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestRespond (0.01s)
=== RUN   TestRedirect
{"level":"info","ts":1728043325.8365767,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39616","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8373475,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39626","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.838297,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39630","headers":{"Accept-Encoding":["gzip"],"Content-Length":["252"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.839655,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.8397932,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.8400514,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.8400743,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043325.8403165,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.8403292,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.840485,"msg":"caddytest: config load time took 2.764772ms"}
{"level":"info","ts":1728043325.8411214,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.8416595,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39636","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8421347,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestRedirect (0.01s)
=== RUN   TestDuplicateHosts
{"level":"info","ts":1728043325.8445284,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39636","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8472483,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39646","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8484902,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39650","headers":{"Accept-Encoding":["gzip"],"Content-Length":["63"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.8488965,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: ambiguous site definition: localhost:9080","status_code":400}
{"level":"info","ts":1728043325.8490999,"msg":"caddytest: config load time took 1.385056ms"}
--- PASS: TestDuplicateHosts (0.00s)
=== RUN   TestReadCookie
{"level":"info","ts":1728043325.84936,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39650","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8500752,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39660","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8512547,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39672","headers":{"Accept-Encoding":["gzip"],"Content-Length":["240"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.852433,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.8525653,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.8533294,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.8533516,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.8533692,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043325.8536942,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.8537114,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.8538518,"msg":"caddytest: config load time took 3.510661ms"}
{"level":"info","ts":1728043325.853887,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.855947,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39680","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.857758,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReadCookie (0.02s)
=== RUN   TestReplIndex
{"level":"info","ts":1728043325.869896,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39680","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8709948,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39686","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8718684,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39688","headers":{"Accept-Encoding":["gzip"],"Content-Length":["269"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.873113,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.8732526,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.8740592,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.8740742,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043325.8740976,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043325.8746326,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.8746586,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.875198,"msg":"caddytest: config load time took 3.95231ms"}
{"level":"info","ts":1728043325.8767076,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.8770223,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39702","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8775318,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReplIndex (0.01s)
=== RUN   TestInvalidPrefix
{"level":"info","ts":1728043325.8791556,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39702","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.880313,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39708","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8816645,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39712","headers":{"Accept-Encoding":["gzip"],"Content-Length":["15"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.8823216,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: server block 0, key 0 (wss://localhost): determining listener address: the scheme wss:// is only supported in browsers; use https:// instead","status_code":400}
{"level":"info","ts":1728043325.8827755,"msg":"caddytest: config load time took 1.896767ms"}
{"level":"info","ts":1728043325.883161,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39712","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8839488,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39726","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8850572,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39728","headers":{"Accept-Encoding":["gzip"],"Content-Length":["14"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.8855016,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: server block 0, key 0 (ws://localhost): determining listener address: the scheme ws:// is only supported in browsers; use http:// instead","status_code":400}
{"level":"info","ts":1728043325.8857448,"msg":"caddytest: config load time took 1.424542ms"}
{"level":"info","ts":1728043325.8863094,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39728","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.887247,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39734","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8883636,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39744","headers":{"Accept-Encoding":["gzip"],"Content-Length":["29"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.8885791,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: server block 0, key 0 (someInvalidPrefix://localhost): determining listener address: unsupported URL scheme someinvalidprefix://","status_code":400}
{"level":"info","ts":1728043325.8887615,"msg":"caddytest: config load time took 1.169764ms"}
{"level":"info","ts":1728043325.889056,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39744","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8897178,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39756","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8915563,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39758","headers":{"Accept-Encoding":["gzip"],"Content-Length":["15"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.8919945,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: server block 0, key 0 (h2c://localhost): determining listener address: unsupported URL scheme h2c://","status_code":400}
{"level":"info","ts":1728043325.8958883,"msg":"caddytest: config load time took 5.985193ms"}
{"level":"info","ts":1728043325.8965437,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39758","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8974564,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39760","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.8987393,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39762","headers":{"Accept-Encoding":["gzip"],"Content-Length":["26"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.8989813,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: server block 0, key 1 (wss://localhost): determining listener address: the scheme wss:// is only supported in browsers; use https:// instead","status_code":400}
{"level":"info","ts":1728043325.899202,"msg":"caddytest: config load time took 1.429883ms"}
{"level":"info","ts":1728043325.8996136,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39762","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9004376,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39770","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9013937,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39782","headers":{"Accept-Encoding":["gzip"],"Content-Length":["61"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.9017913,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: parsing caddyfile tokens for 'reverse_proxy': parsing upstream 'ws://localhost\"': the scheme ws:// is only supported in browsers; use http:// instead, at Caddyfile:2","status_code":400}
{"level":"info","ts":1728043325.9019926,"msg":"caddytest: config load time took 1.247575ms"}
{"level":"info","ts":1728043325.9023685,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39782","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9033966,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39790","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9041688,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39792","headers":{"Accept-Encoding":["gzip"],"Content-Length":["67"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043325.904394,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: parsing caddyfile tokens for 'reverse_proxy': parsing upstream 'someInvalidPrefix://localhost\"': unsupported URL scheme someinvalidprefix://, at Caddyfile:2","status_code":400}
{"level":"info","ts":1728043325.904514,"msg":"caddytest: config load time took 872.841µs"}
--- PASS: TestInvalidPrefix (0.03s)
=== RUN   TestValidPrefix
    caddytest.go:415: warning: Caddyfile:1: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: Caddyfile:1: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: Caddyfile:1: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: Caddyfile:2: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: Caddyfile:2: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: Caddyfile:2: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
    caddytest.go:415: warning: Caddyfile:2: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
--- PASS: TestValidPrefix (0.00s)
=== RUN   TestUriReplace
{"level":"info","ts":1728043325.9076502,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39792","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9084918,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39802","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9093325,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39812","headers":{"Accept-Encoding":["gzip"],"Content-Length":["122"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9104266,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.910585,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9108412,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9108613,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043325.911139,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9111576,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9112802,"msg":"caddytest: config load time took 2.548147ms"}
{"level":"info","ts":1728043325.9121795,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9125752,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39822","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9130368,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestUriReplace (0.01s)
=== RUN   TestUriOps
{"level":"info","ts":1728043325.9138427,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39822","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9144874,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39824","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9153469,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39840","headers":{"Accept-Encoding":["gzip"],"Content-Length":["193"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9168046,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9171698,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9175062,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9175549,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9178388,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9178593,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9180496,"msg":"caddytest: config load time took 3.263306ms"}
{"level":"info","ts":1728043325.9183702,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9194129,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39854","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9199476,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestUriOps (0.01s)
=== RUN   TestHttpRequestLocalPortPlaceholder
{"level":"info","ts":1728043325.9208784,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39854","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9218435,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39870","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9227543,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39880","headers":{"Accept-Encoding":["gzip"],"Content-Length":["94"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9240458,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//[::1]:2999","//127.0.0.1:2999","//localhost:2999"]}
{"level":"warn","ts":1728043325.9241698,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9243238,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9243467,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9246645,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9246843,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9248488,"msg":"caddytest: config load time took 2.729019ms"}
{"level":"info","ts":1728043325.9254496,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.926001,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39894","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9264338,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestHttpRequestLocalPortPlaceholder (0.01s)
=== RUN   TestSetThenAddQueryParams
{"level":"info","ts":1728043325.9275815,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39894","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.928961,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39900","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9302282,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39908","headers":{"Accept-Encoding":["gzip"],"Content-Length":["117"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9313998,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"warn","ts":1728043325.931524,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9317763,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9317925,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9320142,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9320276,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9323864,"msg":"caddytest: config load time took 3.082362ms"}
{"level":"info","ts":1728043325.932782,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9337168,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39922","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9342487,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestSetThenAddQueryParams (0.01s)
=== RUN   TestSetThenDeleteParams
{"level":"info","ts":1728043325.9350553,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39922","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9359655,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39928","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.936996,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39936","headers":{"Accept-Encoding":["gzip"],"Content-Length":["124"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.938162,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.938289,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9385564,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9385853,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.938912,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9389415,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9391353,"msg":"caddytest: config load time took 2.851063ms"}
{"level":"info","ts":1728043325.939787,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9408128,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39952","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9413083,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestSetThenDeleteParams (0.01s)
=== RUN   TestRenameAndOtherOps
{"level":"info","ts":1728043325.942168,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39952","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9430726,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39954","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.944022,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39970","headers":{"Accept-Encoding":["gzip"],"Content-Length":["136"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9454188,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9455514,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9458115,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9458315,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9460988,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9461248,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9463565,"msg":"caddytest: config load time took 2.970898ms"}
{"level":"info","ts":1728043325.947564,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9479485,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39984","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9483814,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestRenameAndOtherOps (0.01s)
=== RUN   TestReplaceOps
{"level":"info","ts":1728043325.949329,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39984","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9501216,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"39988","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9509227,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"39990","headers":{"Accept-Encoding":["gzip"],"Content-Length":["100"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9518673,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9519825,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9521558,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.952169,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9524016,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9524138,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9525497,"msg":"caddytest: config load time took 2.180789ms"}
{"level":"info","ts":1728043325.9532804,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9538069,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40002","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9541583,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReplaceOps (0.01s)
=== RUN   TestReplaceWithReplacementPlaceholder
{"level":"info","ts":1728043325.9550676,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40002","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9559212,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40010","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9566958,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40014","headers":{"Accept-Encoding":["gzip"],"Content-Length":["116"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9579954,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9581556,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9588504,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9588668,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9590921,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9591043,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9592876,"msg":"caddytest: config load time took 3.123756ms"}
{"level":"info","ts":1728043325.9603982,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9666994,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40030","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9672987,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReplaceWithReplacementPlaceholder (0.01s)
=== RUN   TestReplaceWithKeyPlaceholder
{"level":"info","ts":1728043325.9701397,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40030","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9712465,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40040","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9723015,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40042","headers":{"Accept-Encoding":["gzip"],"Content-Length":["116"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9738941,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9742637,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9747596,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.974789,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9754615,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9754894,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9759364,"msg":"caddytest: config load time took 4.365972ms"}
{"level":"info","ts":1728043325.9774082,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9775093,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40052","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9782832,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReplaceWithKeyPlaceholder (0.01s)
=== RUN   TestPartialReplacement
{"level":"info","ts":1728043325.9798784,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40052","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9805548,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40068","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9813323,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40080","headers":{"Accept-Encoding":["gzip"],"Content-Length":["98"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.982337,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9824574,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.982665,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9826834,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9829273,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.982945,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9830556,"msg":"caddytest: config load time took 2.281506ms"}
{"level":"info","ts":1728043325.9836588,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9841647,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40090","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.984502,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestPartialReplacement (0.01s)
=== RUN   TestNonExistingSearch
{"level":"info","ts":1728043325.9853027,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40090","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9860184,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40104","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9867835,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40116","headers":{"Accept-Encoding":["gzip"],"Content-Length":["100"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9877894,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9878948,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.98805,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.9880772,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9883847,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.988403,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.9885051,"msg":"caddytest: config load time took 2.197674ms"}
{"level":"info","ts":1728043325.9891756,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9897761,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40132","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9902735,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestNonExistingSearch (0.01s)
=== RUN   TestReplaceAllOps
{"level":"info","ts":1728043325.9911296,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40132","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.992089,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40144","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9931085,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40160","headers":{"Accept-Encoding":["gzip"],"Content-Length":["98"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.994054,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043325.9941628,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043325.9943478,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043325.994369,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043325.9946375,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043325.9946558,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043325.994789,"msg":"caddytest: config load time took 2.355678ms"}
{"level":"info","ts":1728043325.9953978,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043325.9960806,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40162","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9967105,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReplaceAllOps (0.01s)
=== RUN   TestUriOpsBlock
{"level":"info","ts":1728043325.9974916,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40162","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9982593,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40178","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043325.9992027,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40188","headers":{"Accept-Encoding":["gzip"],"Content-Length":["122"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0002186,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043326.0003266,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043326.000485,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.000507,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043326.0007386,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.0007517,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.0008864,"msg":"caddytest: config load time took 2.300672ms"}
{"level":"info","ts":1728043326.0015454,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.0021906,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40190","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0026765,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestUriOpsBlock (0.01s)
=== RUN   TestHandleErrorSimpleCodes
{"level":"info","ts":1728043326.0035264,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40190","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0044527,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40198","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0053866,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40204","headers":{"Accept-Encoding":["gzip"],"Content-Length":["215"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0067585,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043326.0068996,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043326.0120368,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.0120761,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043326.0124137,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.0124462,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.012721,"msg":"caddytest: config load time took 7.925502ms"}
{"level":"info","ts":1728043326.014224,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40220","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0149238,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestHandleErrorSimpleCodes (0.01s)
=== RUN   TestHandleErrorRange
{"level":"info","ts":1728043326.0158546,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40220","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0162811,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.0165157,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40232","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0173542,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40240","headers":{"Accept-Encoding":["gzip"],"Content-Length":["225"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.018781,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043326.0189378,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043326.0204947,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.0205252,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043326.0209193,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.020937,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.021075,"msg":"caddytest: config load time took 4.279937ms"}
{"level":"info","ts":1728043326.022171,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.0226228,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40244","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0231473,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestHandleErrorRange (0.01s)
=== RUN   TestHandleErrorSort
{"level":"info","ts":1728043326.0242925,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40244","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0250552,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40260","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0259042,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40276","headers":{"Accept-Encoding":["gzip"],"Content-Length":["360"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.029036,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"warn","ts":1728043326.0292645,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043326.0309155,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.0309331,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043326.031207,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.031235,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.0313714,"msg":"caddytest: config load time took 6.07531ms"}
{"level":"info","ts":1728043326.0328026,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.0332642,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40282","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0339785,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestHandleErrorSort (0.01s)
=== RUN   TestHandleErrorRangeAndCodes
{"level":"info","ts":1728043326.0355568,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40282","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.036385,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40290","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0372396,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40298","headers":{"Accept-Encoding":["gzip"],"Content-Length":["386"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.038965,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043326.039122,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043326.0417068,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.041735,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043326.0420566,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.0420804,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.0422945,"msg":"caddytest: config load time took 5.611204ms"}
{"level":"info","ts":1728043326.043399,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.0441132,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40302","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0446644,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestHandleErrorRangeAndCodes (0.01s)
=== RUN   TestInvalidSiteAddressesAsDirectives
{"level":"info","ts":1728043326.0459328,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40302","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0468037,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40316","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0478354,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40318","headers":{"Accept-Encoding":["gzip"],"Content-Length":["33"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043326.0479178,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: Caddyfile:2: parsed 'handle' as a site address, but it is a known directive; directives must appear in a site block","status_code":400}
{"level":"info","ts":1728043326.0480971,"msg":"caddytest: config load time took 930.084µs"}
{"level":"info","ts":1728043326.048295,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40318","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0492566,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40324","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.050156,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40332","headers":{"Accept-Encoding":["gzip"],"Content-Length":["70"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"error","ts":1728043326.0503364,"logger":"admin.api","msg":"request error","error":"adapting config using caddyfile adapter: Caddyfile:2: parsed 'reverse_proxy' as a site address, but it is a known directive; directives must appear in a site block","status_code":400}
{"level":"info","ts":1728043326.0506215,"msg":"caddytest: config load time took 1.025677ms"}
--- PASS: TestInvalidSiteAddressesAsDirectives (0.00s)
=== RUN   TestBrowse
{"level":"info","ts":1728043326.0509195,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40332","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.051766,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40348","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0527654,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40360","headers":{"Accept-Encoding":["gzip"],"Content-Length":["164"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.053812,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"warn","ts":1728043326.0539463,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043326.0546734,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.0546956,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043326.0547166,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043326.055017,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.05503,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.0551274,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.0553222,"msg":"caddytest: config load time took 3.190841ms"}
{"level":"info","ts":1728043326.0565813,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40376","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0570972,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestBrowse (0.01s)
=== RUN   TestRespondWithJSON
{"level":"info","ts":1728043326.0637813,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40376","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0648253,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40378","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0658448,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40390","headers":{"Accept-Encoding":["gzip"],"Content-Length":["161"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.067282,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"info","ts":1728043326.0683477,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043326.0683832,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043326.0686996,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043326.0691147,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.0691876,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.0691977,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["localhost"]}
{"level":"warn","ts":1728043326.0700266,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [localhost]: no OCSP server specified in certificate","identifiers":["localhost"]}
{"level":"info","ts":1728043326.0701938,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043326.0703936,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043326.0709226,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.0709453,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.0711637,"msg":"caddytest: config load time took 5.970398ms"}
{"level":"info","ts":1728043326.072645,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40400","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:472: Content-Type header not provided
{"level":"info","ts":1728043326.0730631,"msg":"caddytest: redirecting the dialer from localhost:9443 to 127.0.0.1:9443"}
--- PASS: TestRespondWithJSON (0.01s)
=== RUN   TestIntercept
{"level":"info","ts":1728043326.0754504,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.0757394,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40400","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0767865,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40414","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0776548,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40424","headers":{"Accept-Encoding":["gzip"],"Content-Length":["404"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0795417,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043326.0797606,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043326.0807843,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043326.0808017,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043326.0808182,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"error","ts":1728043326.080895,"logger":"http","msg":"server shutdown","error":"context deadline exceeded","addresses":[":9443"]}
{"level":"info","ts":1728043326.0811296,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043326.0811484,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043326.0812778,"msg":"caddytest: config load time took 4.244821ms"}
{"level":"info","ts":1728043326.0823646,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043326.083064,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40434","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.083699,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestIntercept (0.01s)
=== RUN   TestLeafCertLoaders
{"level":"info","ts":1728043326.0848742,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40434","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0857513,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40436","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"http": {
        				"http_port": 9080,
               			"https_port": 9443,
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":9443"
        						],
        						"routes": [
        							{
        								"match": [
        									{
        										"host": [
        											"localhost"
        										]
        									}
        								],
        								"terminal": true
        							}
        						],
        						"tls_connection_policies": [
        							{
        								"client_authentication": {
        									"verifiers": [
        										{
        											"verifier": "leaf",
        											"leaf_certs_loaders": [
        												{
        													"loader": "file",
        													"files": ["../leafcert.pem"]
        												}, 
        												{
        													"loader": "folder", 
        													"folders": ["../"]
        												},
        												{
        													"loader": "storage"
        												},
        												{
        													"loader": "pem"
        												}
        											]
        										}
        									]
        								}
        							}
        						]
        					}
        				}
        			}
        		}
        	}
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"http_port":9080,"https_port":9443,"servers":{"srv0":{"listen":[":9443"],"routes":[{"match":[{"host":["localhost"]}],"terminal":true}],"tls_connection_policies":[{"client_authentication":{"verifiers":[{"leaf_certs_loaders":[{"files":["../leafcert.pem"],"loader":"file"},{"folders":["../"],"loader":"folder"},{"loader":"storage"},{"loader":"pem"}],"verifier":"leaf"}]}}]}}}}}
{"level":"info","ts":1728043326.087036,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40442","headers":{"Accept-Encoding":["gzip"],"Content-Length":["444"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043326.0878198,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043326.0880208,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"warn","ts":1728043326.088746,"logger":"http","msg":"enabling strict SNI-Host enforcement because TLS client auth is configured","server_id":"srv0"}
{"level":"warn","ts":1728043326.0916533,"logger":"pki.ca.local","msg":"installing root certificate (you might be prompted for password)","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043326.0921054,"msg":"warning: \"certutil\" is not available, install \"certutil\" with \"apt install libnss3-tools\" or \"yum install nss-tools\" and try again"}
{"level":"info","ts":1728043326.0921304,"msg":"define JAVA_HOME environment variable to use the Java trust"}
{"level":"info","ts":1728043328.0652113,"msg":"certificate installed properly in linux trusts"}
{"level":"info","ts":1728043328.0656972,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043328.0661464,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.0670745,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.0671327,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["localhost"]}
{"level":"warn","ts":1728043328.0684896,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [localhost]: no OCSP server specified in certificate","identifiers":["localhost"]}
{"level":"info","ts":1728043328.0686963,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043328.0692203,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043328.0692604,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043328.0695467,"msg":"caddytest: config load time took 1.983175792s"}
{"level":"info","ts":1728043328.0730236,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40450","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
--- PASS: TestLeafCertLoaders (1.99s)
=== RUN   TestHTTPRedirectWrapperWithLargeUpload
{"level":"info","ts":1728043328.0777383,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40450","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.0788805,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40458","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.0805266,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40468","headers":{"Accept-Encoding":["gzip"],"Content-Length":["233"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.0818064,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043328.082422,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043328.0824435,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043328.0826905,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043328.0827727,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043328.0827935,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.082841,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.0828464,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["localhost"]}
{"level":"info","ts":1728043328.082862,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043328.0831254,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043328.0831356,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043328.0832565,"msg":"caddytest: config load time took 3.983199ms"}
{"level":"info","ts":1728043328.0854673,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043328.0858696,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40482","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.086879,"msg":"caddytest: redirecting the dialer from localhost:9443 to 127.0.0.1:9443"}
--- PASS: TestHTTPRedirectWrapperWithLargeUpload (0.03s)
=== RUN   TestLargeHttpRequest
{"level":"info","ts":1728043328.1013348,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40482","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1029055,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40494","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1041274,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40504","headers":{"Accept-Encoding":["gzip"],"Content-Length":["233"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.105085,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043328.1056118,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":9443}
{"level":"info","ts":1728043328.105635,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043328.1058261,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043328.1058524,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.1058905,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.1058955,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["localhost"]}
{"level":"info","ts":1728043328.105904,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043328.1059222,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043328.1062503,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043328.1062737,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043328.1063802,"msg":"caddytest: config load time took 3.08589ms"}
{"level":"info","ts":1728043328.10639,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043328.1075623,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40506","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1101544,"msg":"caddytest: redirecting the dialer from localhost:9443 to 127.0.0.1:9443"}
--- PASS: TestLargeHttpRequest (0.02s)
=== RUN   TestMap
{"level":"info","ts":1728043328.122055,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40506","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1235056,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40518","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1247673,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40534","headers":{"Accept-Encoding":["gzip"],"Content-Length":["361"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.127519,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//127.0.0.1:2999","//localhost:2999","//[::1]:2999"]}
{"level":"warn","ts":1728043328.128087,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043328.1295338,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.1295722,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043328.1296446,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043328.1300337,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043328.130056,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043328.1302397,"msg":"caddytest: config load time took 6.363659ms"}
{"level":"info","ts":1728043328.1315453,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043328.1317258,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40542","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1322484,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
    caddytest.go:472: Content-Type header not provided
--- PASS: TestMap (0.01s)
=== RUN   TestMapRespondWithDefault
{"level":"info","ts":1728043328.1339386,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40542","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.135296,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40556","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1369774,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40564","headers":{"Accept-Encoding":["gzip"],"Content-Length":["291"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.138918,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043328.1391418,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043328.139874,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.139894,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043328.1399105,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043328.140169,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043328.1401927,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043328.1403096,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043328.140344,"msg":"caddytest: config load time took 4.312834ms"}
{"level":"info","ts":1728043328.1424131,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40574","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1431286,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
    caddytest.go:472: Content-Type header not provided
--- PASS: TestMapRespondWithDefault (0.01s)
=== RUN   TestMapAsJSON
{"level":"info","ts":1728043328.1446068,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40574","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1460037,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40580","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"pki": {
        				"certificate_authorities" : {
        				  "local" : {
        					"install_trust": false
        				  }
        				}
        			},
        			"http": {
        				"http_port": 9080,
        				"https_port": 9443,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":9080"
        						],
        						"routes": [
        							{
        								"handle": [
        									{
        										"handler": "subroute",
        										"routes": [
        											{
        												"handle": [
        													{
        														"handler": "map",
        														"source": "{http.request.method}",
        														"destinations": ["{dest-name}"],
        														"defaults": ["unknown"],
        														"mappings": [
        															{
        																"input": "GET",
        																"outputs": ["get-called"]
        															},
        															{
        																"input": "POST",
        																"outputs": ["post-called"]
        															}
        														]
        													}
        												]
        											},
        											{
        												"handle": [
        													{
        														"body": "hello from localhost {dest-name}",
        														"handler": "static_response",
        														"status_code": 200
        													}
        												],
        												"match": [
        													{
        														"path": ["/version"]
        													}
        												]
        											}
        										]
        									}
        								],
        								"match": [
        									{
        										"host": ["localhost"]
        									}
        								],
        								"terminal": true
        							}
        						]
        					}
        				}
        			}
        		}
        	}
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"http_port":9080,"https_port":9443,"servers":{"srv0":{"listen":[":9080"],"routes":[{"handle":[{"handler":"subroute","routes":[{"handle":[{"defaults":["unknown"],"destinations":["{dest-name}"],"handler":"map","mappings":[{"input":"GET","outputs":["get-called"]},{"input":"POST","outputs":["post-called"]}],"source":"{http.request.method}"}]},{"handle":[{"body":"hello from localhost {dest-name}","handler":"static_response","status_code":200}],"match":[{"path":["/version"]}]}]}],"match":[{"host":["localhost"]}],"terminal":true}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}}}}
{"level":"info","ts":1728043328.1474907,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40590","headers":{"Accept-Encoding":["gzip"],"Content-Length":["655"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1483338,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043328.1484807,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043328.1492832,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043328.1492994,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043328.1493158,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043328.1497538,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043328.1497679,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043328.1501112,"msg":"caddytest: config load time took 3.456867ms"}
{"level":"info","ts":1728043328.150495,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043328.1516936,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40604","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.152274,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
    caddytest.go:472: Content-Type header not provided
--- PASS: TestMapAsJSON (0.01s)
=== RUN   TestLeafCertLifetimeLessThanIntermediate
{"level":"info","ts":1728043328.15336,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40604","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043328.1542199,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40620","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
            {
              "admin": {
                "disabled": true
              },
              "apps": {
                "http": {
                  "servers": {
                    "srv0": {
                      "listen": [
                        ":443"
                      ],
                      "routes": [
                        {
                          "handle": [
                            {
                              "handler": "subroute",
                              "routes": [
                                {
                                  "handle": [
                                    {
                                      "ca": "internal",
                                      "handler": "acme_server",
                                      "lifetime": 604800000000000
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  }
                },
                "pki": {
                  "certificate_authorities": {
                    "internal": {
                      "install_trust": false,
                      "intermediate_lifetime": 604800000000000,
                      "name": "Internal CA"
                    }
                  }
                }
              }
            }
        	
    caddytest.go:151: After: {"admin":{"disabled":true},"apps":{"http":{"servers":{"srv0":{"listen":[":443"],"routes":[{"handle":[{"handler":"subroute","routes":[{"handle":[{"ca":"internal","handler":"acme_server","lifetime":604800000000000}]}]}]}]}}},"pki":{"certificate_authorities":{"internal":{"install_trust":false,"intermediate_lifetime":604800000000000,"name":"Internal CA"}}}}}
{"level":"info","ts":1728043328.1553373,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40624","headers":{"Accept-Encoding":["gzip"],"Content-Length":["356"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"warn","ts":1728043328.1555886,"logger":"admin","msg":"admin endpoint disabled"}
{"level":"info","ts":1728043328.159287,"logger":"http.auto_https","msg":"server is listening only on the HTTPS port but has no TLS connection policies; adding one to enable TLS","server_name":"srv0","https_port":443}
{"level":"info","ts":1728043328.159312,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"error","ts":1728043328.1595123,"logger":"admin.api","msg":"request error","error":"loading config: loading new config: loading http app module: provision http: server srv0: setting up route handlers: route 0: loading handler modules: position 0: loading module 'subroute': provision http.handlers.subroute: setting up subroutes: route 0: loading handler modules: position 0: loading module 'acme_server': provision http.handlers.acme_server: certificate lifetime (168h0m0s) should be less than intermediate certificate lifetime (168h0m0s)","status_code":400}
{"level":"info","ts":1728043328.1597211,"msg":"caddytest: config load time took 4.995726ms"}
--- PASS: TestLeafCertLifetimeLessThanIntermediate (0.01s)
=== RUN   TestIntermediateLifetimeLessThanRoot
{"level":"info","ts":1728043328.1598916,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043328.16128,"msg":"using config from file","file":"/tmp/3663953227"}
{"level":"info","ts":1728043328.161469,"msg":"adapted config to JSON","adapter":"caddyfile"}
{"level":"info","ts":1728043328.1619658,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043328.1620042,"logger":"http","msg":"servers shutting down with eternal grace period"}
{"level":"info","ts":1728043328.162066,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043328.1620948,"logger":"tls.cache.maintenance","msg":"stopped background certificate maintenance","cache":"0xc000706400"}
{"level":"info","ts":1728043328.1622787,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043328.162293,"msg":"serving initial configuration"}
{"level":"info","ts":1728043328.2138166,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043329.1632795,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40650","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043329.1644657,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40666","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
            {
              "admin": {
                "disabled": true
              },
              "apps": {
                "http": {
                  "servers": {
                    "srv0": {
                      "listen": [
                        ":443"
                      ],
                      "routes": [
                        {
                          "handle": [
                            {
                              "handler": "subroute",
                              "routes": [
                                {
                                  "handle": [
                                    {
                                      "ca": "internal",
                                      "handler": "acme_server",
                                      "lifetime": 2592000000000000
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  }
                },
                "pki": {
                  "certificate_authorities": {
                    "internal": {
                      "install_trust": false,
                      "intermediate_lifetime": 311040000000000000,
                      "name": "Internal CA"
                    }
                  }
                }
              }
            }
        	
    caddytest.go:151: After: {"admin":{"disabled":true},"apps":{"http":{"servers":{"srv0":{"listen":[":443"],"routes":[{"handle":[{"handler":"subroute","routes":[{"handle":[{"ca":"internal","handler":"acme_server","lifetime":2592000000000000}]}]}]}]}}},"pki":{"certificate_authorities":{"internal":{"install_trust":false,"intermediate_lifetime":311040000000000000,"name":"Internal CA"}}}}}
{"level":"info","ts":1728043329.1661148,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40674","headers":{"Accept-Encoding":["gzip"],"Content-Length":["360"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"warn","ts":1728043329.166436,"logger":"admin","msg":"admin endpoint disabled"}
{"level":"error","ts":1728043329.1665604,"logger":"admin.api","msg":"request error","error":"loading config: loading new config: loading pki app module: provision pki: provisioning CA 'internal': intermediate certificate lifetime must be less than root certificate lifetime (86400h0m0s)","status_code":400}
{"level":"info","ts":1728043329.166751,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043329.1668653,"msg":"caddytest: config load time took 1.682107ms"}
--- PASS: TestIntermediateLifetimeLessThanRoot (1.01s)
=== RUN   TestSRVReverseProxy
{"level":"info","ts":1728043329.1700785,"msg":"using config from file","file":"/tmp/4098949555"}
{"level":"info","ts":1728043329.170382,"msg":"adapted config to JSON","adapter":"caddyfile"}
{"level":"info","ts":1728043329.1712596,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//[::1]:2999","//127.0.0.1:2999","//localhost:2999"]}
{"level":"info","ts":1728043329.1714616,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043329.171542,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043329.1715631,"msg":"serving initial configuration"}
{"level":"info","ts":1728043330.1718137,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40700","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1734703,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40710","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"pki": {
        				"certificate_authorities": {
        					"local": {
        						"install_trust": false
        					}
        				}
        			},
        			"http": {
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":18080"
        						],
        						"routes": [
        							{
        								"handle": [
        									{
        										"handler": "reverse_proxy",
        										"dynamic_upstreams": {
        											"source": "srv",
        											"name": "srv.host.service.consul"
        										}
        									}
        								]
        							}
        						]
        					}
        				}
        			}
        		}
        	}
        	
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"servers":{"srv0":{"listen":[":18080"],"routes":[{"handle":[{"dynamic_upstreams":{"name":"srv.host.service.consul","source":"srv"},"handler":"reverse_proxy"}]}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}}}}
{"level":"info","ts":1728043330.1748307,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40718","headers":{"Accept-Encoding":["gzip"],"Content-Length":["303"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1755424,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043330.176638,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.1766577,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.1768725,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.1768863,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.1771119,"msg":"caddytest: config load time took 3.113117ms"}
{"level":"info","ts":1728043330.1772134,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.1772604,"logger":"tls.cache.maintenance","msg":"started background certificate maintenance","cache":"0xc000b8fa00"}
{"level":"info","ts":1728043330.1780896,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40722","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
--- PASS: TestSRVReverseProxy (1.01s)
=== RUN   TestDialWithPlaceholderUnix
{"level":"info","ts":1728043330.1791823,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40722","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1800268,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40724","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"pki": {
        				"certificate_authorities": {
        					"local": {
        						"install_trust": false
        					}
        				}
        			},
        			"http": {
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":18080"
        						],
        						"routes": [
        							{
        								"handle": [
        									{
        										"handler": "reverse_proxy",
        										"upstreams": [
        											{
        												"dial": "unix/{http.request.header.X-Caddy-Upstream-Dial}"
        											}
        										]
        									}
        								]
        							}
        						]
        					}
        				}
        		  	}
        		}
        	}
        	
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"servers":{"srv0":{"listen":[":18080"],"routes":[{"handle":[{"handler":"reverse_proxy","upstreams":[{"dial":"unix/{http.request.header.X-Caddy-Upstream-Dial}"}]}]}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}}}}
{"level":"info","ts":1728043330.181366,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40734","headers":{"Accept-Encoding":["gzip"],"Content-Length":["307"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1820338,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043330.1829476,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.1829715,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.1829965,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043330.1833246,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.1833467,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.1836815,"msg":"caddytest: config load time took 3.061891ms"}
{"level":"info","ts":1728043330.1836898,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.1847875,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40736","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1852286,"msg":"caddytest: redirecting the dialer from localhost:18080 to 127.0.0.1:18080"}
--- PASS: TestDialWithPlaceholderUnix (0.01s)
=== RUN   TestReverseProxyWithPlaceholderDialAddress
{"level":"info","ts":1728043330.1869311,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40736","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.187992,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40740","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"pki": {
        				"certificate_authorities": {
        					"local": {
        						"install_trust": false
        					}
        				}
        			},
        			"http": {
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":18080"
        						],
        						"routes": [
        							{
        								"match": [
        									{
        										"host": [
        											"localhost"
        										]
        									}
        								],
        								"handle": [
        									{
        										"handler": "static_response",
        										"body": "Hello, World!"
        									}
        								],
        								"terminal": true
        							}
        						],
        						"automatic_https": {
        							"skip": [
        								"localhost"
        							]
        						}
        					},
        					"srv1": {
        						"listen": [
        							":9080"
        						],
        						"routes": [
        							{
        								"match": [
        									{
        										"host": [
        											"localhost"
        										]
        									}
        								],
        								"handle": [
        									{
        	
        										"handler": "reverse_proxy",
        										"upstreams": [
        											{
        												"dial": "{http.request.header.X-Caddy-Upstream-Dial}"
        											}
        										]
        									}
        								],
        								"terminal": true
        							}
        						],
        						"automatic_https": {
        							"skip": [
        								"localhost"
        							]
        						}
        					}
        				}
        			}
        		}
        	}
        	
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"servers":{"srv0":{"automatic_https":{"skip":["localhost"]},"listen":[":18080"],"routes":[{"handle":[{"body":"Hello, World!","handler":"static_response"}],"match":[{"host":["localhost"]}],"terminal":true}]},"srv1":{"automatic_https":{"skip":["localhost"]},"listen":[":9080"],"routes":[{"handle":[{"handler":"reverse_proxy","upstreams":[{"dial":"{http.request.header.X-Caddy-Upstream-Dial}"}]}],"match":[{"host":["localhost"]}],"terminal":true}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}}}}
{"level":"info","ts":1728043330.1893723,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40750","headers":{"Accept-Encoding":["gzip"],"Content-Length":["587"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1901824,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043330.1908815,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.190986,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.1910453,"logger":"http.log","msg":"server running","name":"srv1","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.1910555,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043330.1913033,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.1913261,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.1914403,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.1914737,"msg":"caddytest: config load time took 2.88676ms"}
{"level":"info","ts":1728043330.1924932,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40760","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1930122,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReverseProxyWithPlaceholderDialAddress (0.01s)
=== RUN   TestReverseProxyWithPlaceholderTCPDialAddress
{"level":"info","ts":1728043330.1952112,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40760","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.1963584,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40770","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: 
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"pki": {
        				"certificate_authorities": {
        					"local": {
        						"install_trust": false
        					}
        				}
        			},
        			"http": {
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":18080"
        						],
        						"routes": [
        							{
        								"match": [
        									{
        										"host": [
        											"localhost"
        										]
        									}
        								],
        								"handle": [
        									{
        										"handler": "static_response",
        										"body": "Hello, World!"
        									}
        								],
        								"terminal": true
        							}
        						],
        						"automatic_https": {
        							"skip": [
        								"localhost"
        							]
        						}
        					},
        					"srv1": {
        						"listen": [
        							":9080"
        						],
        						"routes": [
        							{
        								"match": [
        									{
        										"host": [
        											"localhost"
        										]
        									}
        								],
        								"handle": [
        									{
        	
        										"handler": "reverse_proxy",
        										"upstreams": [
        											{
        												"dial": "tcp/{http.request.header.X-Caddy-Upstream-Dial}:18080"
        											}
        										]
        									}
        								],
        								"terminal": true
        							}
        						],
        						"automatic_https": {
        							"skip": [
        								"localhost"
        							]
        						}
        					}
        				}
        			}
        		}
        	}
        	
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"servers":{"srv0":{"automatic_https":{"skip":["localhost"]},"listen":[":18080"],"routes":[{"handle":[{"body":"Hello, World!","handler":"static_response"}],"match":[{"host":["localhost"]}],"terminal":true}]},"srv1":{"automatic_https":{"skip":["localhost"]},"listen":[":9080"],"routes":[{"handle":[{"handler":"reverse_proxy","upstreams":[{"dial":"tcp/{http.request.header.X-Caddy-Upstream-Dial}:18080"}]}],"match":[{"host":["localhost"]}],"terminal":true}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}}}}
{"level":"info","ts":1728043330.1977262,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40786","headers":{"Accept-Encoding":["gzip"],"Content-Length":["597"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.198635,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"info","ts":1728043330.19947,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.199525,"logger":"http.log","msg":"server running","name":"srv1","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.199532,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.1995473,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043330.1999588,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.1999803,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.2001247,"msg":"caddytest: config load time took 3.100475ms"}
{"level":"info","ts":1728043330.2001455,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.2012818,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40792","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.201844,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReverseProxyWithPlaceholderTCPDialAddress (0.01s)
=== RUN   TestReverseProxyHealthCheck
{"level":"info","ts":1728043330.2036262,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40792","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.204949,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40796","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.2060125,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40804","headers":{"Accept-Encoding":["gzip"],"Content-Length":["410"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.2080483,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043330.2083213,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv2","http_port":9080}
{"level":"info","ts":1728043330.2094376,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.209485,"logger":"http.log","msg":"server running","name":"srv1","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.209519,"logger":"http.log","msg":"server running","name":"srv2","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.2095253,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.2095387,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043330.210484,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.2105012,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.210491,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.2106354,"msg":"caddytest: config load time took 5.346494ms"}
{"level":"info","ts":1728043330.2107368,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.2133718,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40808","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.2210186,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.2310991,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.2414362,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.2512708,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.26108,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.2709217,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.2807493,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.290476,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.3011231,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.3110368,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.3155265,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReverseProxyHealthCheck (0.11s)
=== RUN   TestReverseProxyHealthCheckUnixSocket
{"level":"info","ts":1728043330.3178992,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40808","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3188999,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40822","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3201082,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40836","headers":{"Accept-Encoding":["gzip"],"Content-Length":["282"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3201506,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost:2021"}
{"level":"info","ts":1728043330.3215537,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043330.3217013,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"error","ts":1728043330.3219812,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"active health check failed","address":"/tmp/2718711546.sock:2021","error":"making request: parse \"http://%2Ftmp%2F2718711546.sock:2021/health\": invalid URL escape \"%2F\""}
{"level":"info","ts":1728043330.3224375,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.322454,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.32247,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043330.3228493,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.322871,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.3229978,"msg":"caddytest: config load time took 3.673187ms"}
{"level":"info","ts":1728043330.3246636,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40840","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3251433,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.3251476,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
--- PASS: TestReverseProxyHealthCheckUnixSocket (0.01s)
=== RUN   TestReverseProxyHealthCheckUnixSocketWithoutPort
{"level":"info","ts":1728043330.3273427,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40840","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3282237,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40842","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3292544,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40856","headers":{"Accept-Encoding":["gzip"],"Content-Length":["261"],"Content-Type":["text/caddyfile"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.33079,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043330.3308964,"logger":"http.auto_https","msg":"server is listening only on the HTTP port, so no automatic HTTPS will be applied to this server","server_name":"srv0","http_port":9080}
{"level":"info","ts":1728043330.3315122,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.3315287,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.331541,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043330.3316207,"logger":"http.handlers.reverse_proxy.health_checker.active","msg":"host is up","host":"localhost"}
{"level":"info","ts":1728043330.331993,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.3320282,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.3321729,"msg":"caddytest: config load time took 3.625664ms"}
{"level":"info","ts":1728043330.3336365,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40860","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3341513,"msg":"caddytest: redirecting the dialer from localhost:9080 to 127.0.0.1:9080"}
{"level":"info","ts":1728043330.3343313,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
--- PASS: TestReverseProxyHealthCheckUnixSocketWithoutPort (0.01s)
=== RUN   TestDefaultSNI
{"level":"info","ts":1728043330.3355684,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40860","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3367426,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40864","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before: {
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"http": {
        				"http_port": 9080,
        				"https_port": 9443,
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":9443"
        						],
        						"routes": [
        							{
        								"handle": [
        									{
        										"handler": "subroute",
        										"routes": [
        											{
        												"handle": [
        													{
        														"body": "hello from a.caddy.localhost",
        														"handler": "static_response",
        														"status_code": 200
        													}
        												],
        												"match": [
        													{
        														"path": [
        															"/version"
        														]
        													}
        												]
        											}
        										]
        									}
        								],
        								"match": [
        									{
        										"host": [
        											"127.0.0.1"
        										]
        									}
        								],
        								"terminal": true
        							}
        						],
        						"tls_connection_policies": [
        							{
        								"certificate_selection": {
        									"any_tag": ["cert0"]
        								},
        								"match": {
        									"sni": [
        										"127.0.0.1"
        									]
        								}
        							},
        							{
        								"default_sni": "*.caddy.localhost"
        							}
        						]
        					}
        				}
        			},
        			"tls": {
        				"certificates": {
        					"load_files": [
        						{
        							"certificate": "/testbed/caddytest/caddy.localhost.crt",
        							"key": "/testbed/caddytest/caddy.localhost.key",
        							"tags": [
        								"cert0"
        							]
        						}
        					]
        				}
        			},
        			"pki": {
        				"certificate_authorities" : {
        					"local" : {
        						"install_trust": false
        					}
        				}
        			}
        		}
        	}
        	
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"http_port":9080,"https_port":9443,"servers":{"srv0":{"listen":[":9443"],"routes":[{"handle":[{"handler":"subroute","routes":[{"handle":[{"body":"hello from a.caddy.localhost","handler":"static_response","status_code":200}],"match":[{"path":["/version"]}]}]}],"match":[{"host":["127.0.0.1"]}],"terminal":true}],"tls_connection_policies":[{"certificate_selection":{"any_tag":["cert0"]},"match":{"sni":["127.0.0.1"]}},{"default_sni":"*.caddy.localhost"}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}},"tls":{"certificates":{"load_files":[{"certificate":"/testbed/caddytest/caddy.localhost.crt","key":"/testbed/caddytest/caddy.localhost.key","tags":["cert0"]}]}}}}
{"level":"info","ts":1728043330.3388042,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40870","headers":{"Accept-Encoding":["gzip"],"Content-Length":["756"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.340139,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043330.3414638,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [*.caddy.localhost]: no OCSP server specified in certificate"}
{"level":"info","ts":1728043330.3416677,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043330.3419442,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.3420613,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043330.3424163,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.3424807,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.342487,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["127.0.0.1"]}
{"level":"info","ts":1728043330.3426254,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"info","ts":1728043330.3430178,"logger":"tls.obtain","msg":"acquiring lock","identifier":"127.0.0.1"}
{"level":"info","ts":1728043330.3431535,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.3432279,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.3445508,"msg":"caddytest: config load time took 7.052062ms"}
{"level":"info","ts":1728043330.3468778,"logger":"tls.obtain","msg":"lock acquired","identifier":"127.0.0.1"}
{"level":"info","ts":1728043330.347025,"logger":"tls.obtain","msg":"obtaining certificate","identifier":"127.0.0.1"}
{"level":"info","ts":1728043330.3487234,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.3492553,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40878","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3494167,"logger":"tls.obtain","msg":"certificate obtained successfully","identifier":"127.0.0.1","issuer":"local"}
{"level":"info","ts":1728043330.349564,"logger":"tls.obtain","msg":"releasing lock","identifier":"127.0.0.1"}
{"level":"info","ts":1728043330.350119,"msg":"caddytest: redirecting the dialer from 127.0.0.1:9443 to 127.0.0.1:9443"}
{"level":"warn","ts":1728043330.3501453,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [127.0.0.1]: no OCSP server specified in certificate","identifiers":["127.0.0.1"]}
--- PASS: TestDefaultSNI (0.02s)
=== RUN   TestDefaultSNIWithNamedHostAndExplicitIP
{"level":"info","ts":1728043330.3530264,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40878","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3540516,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40880","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before:  
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"http": {
        				"http_port": 9080,
        				"https_port": 9443,
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":9443"
        						],
        						"routes": [
        							{
        								"handle": [
        									{
        										"handler": "subroute",
        										"routes": [
        											{
        												"handle": [
        													{
        														"body": "hello from a",
        														"handler": "static_response",
        														"status_code": 200
        													}
        												],
        												"match": [
        													{
        														"path": [
        															"/version"
        														]
        													}
        												]
        											}
        										]
        									}
        								],
        								"match": [
        									{
        										"host": [
        											"a.caddy.localhost",
        											"127.0.0.1"
        										]
        									}
        								],
        								"terminal": true
        							}
        						],
        						"tls_connection_policies": [
        							{
        								"certificate_selection": {
        									"any_tag": ["cert0"]
        								},
        								"default_sni": "a.caddy.localhost",
        								"match": {
        									"sni": [
        										"a.caddy.localhost",
        										"127.0.0.1",
        										""
        									]
        								}
        							},
        							{
        								"default_sni": "a.caddy.localhost"
        							}
        						]
        					}
        				}
        			},
        			"tls": {
        				"certificates": {
        					"load_files": [
        						{
        							"certificate": "/testbed/caddytest/a.caddy.localhost.crt",
        							"key": "/testbed/caddytest/a.caddy.localhost.key",
        							"tags": [
        								"cert0"
        							]
        						}
        					]
        				}
        			},
        			"pki": {
        				"certificate_authorities" : {
        					"local" : {
        						"install_trust": false
        					}
        				}
        			}
        		}
        	}
        	
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"http_port":9080,"https_port":9443,"servers":{"srv0":{"listen":[":9443"],"routes":[{"handle":[{"handler":"subroute","routes":[{"handle":[{"body":"hello from a","handler":"static_response","status_code":200}],"match":[{"path":["/version"]}]}]}],"match":[{"host":["a.caddy.localhost","127.0.0.1"]}],"terminal":true}],"tls_connection_policies":[{"certificate_selection":{"any_tag":["cert0"]},"default_sni":"a.caddy.localhost","match":{"sni":["a.caddy.localhost","127.0.0.1",""]}},{"default_sni":"a.caddy.localhost"}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}},"tls":{"certificates":{"load_files":[{"certificate":"/testbed/caddytest/a.caddy.localhost.crt","key":"/testbed/caddytest/a.caddy.localhost.key","tags":["cert0"]}]}}}}
{"level":"info","ts":1728043330.3555787,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40882","headers":{"Accept-Encoding":["gzip"],"Content-Length":["821"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3564363,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//[::1]:2999","//127.0.0.1:2999","//localhost:2999"]}
{"level":"warn","ts":1728043330.3570962,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [a.caddy.localhost]: no OCSP server specified in certificate"}
{"level":"info","ts":1728043330.357254,"logger":"http.auto_https","msg":"skipping automatic certificate management because one or more matching certificates are already loaded","domain":"a.caddy.localhost","server_name":"srv0"}
{"level":"info","ts":1728043330.3572688,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043330.357988,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.3580801,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043330.358117,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.3582065,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.3582165,"logger":"http","msg":"enabling automatic TLS certificate management","domains":["127.0.0.1"]}
{"level":"info","ts":1728043330.3582358,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"error","ts":1728043330.3584218,"logger":"http","msg":"server shutdown","error":"context deadline exceeded","addresses":[":9443"]}
{"level":"info","ts":1728043330.358876,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.3589015,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.3593206,"msg":"caddytest: config load time took 4.628333ms"}
{"level":"info","ts":1728043330.3598917,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.360806,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40898","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.361255,"msg":"caddytest: redirecting the dialer from 127.0.0.1:9443 to 127.0.0.1:9443"}
--- PASS: TestDefaultSNIWithNamedHostAndExplicitIP (0.01s)
=== RUN   TestDefaultSNIWithPortMappingOnly
{"level":"info","ts":1728043330.3668568,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40898","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3678417,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40908","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before:  
        	{
        		"admin": {
        			"listen": "localhost:2999"
        		},
        		"apps": {
        			"http": {
        				"http_port": 9080,
        				"https_port": 9443,
        				"grace_period": 1,
        				"servers": {
        					"srv0": {
        						"listen": [
        							":9443"
        						],
        						"routes": [
        							{
        								"handle": [
        									{
        										"body": "hello from a.caddy.localhost",
        										"handler": "static_response",
        										"status_code": 200
        									}
        								],
        								"match": [
        									{
        										"path": [
        											"/version"
        										]
        									}
        								]
        							}
        						],
        						"tls_connection_policies": [
        							{
        								"certificate_selection": {
        									"any_tag": ["cert0"]
        								},
        								"default_sni": "a.caddy.localhost"
        							}
        						]
        					}
        				}
        			},
        			"tls": {
        				"certificates": {
        					"load_files": [
        						{
        							"certificate": "/testbed/caddytest/a.caddy.localhost.crt",
        							"key": "/testbed/caddytest/a.caddy.localhost.key",
        							"tags": [
        								"cert0"
        							]
        						}
        					]
        				}
        			},
        			"pki": {
        				"certificate_authorities" : {
        					"local" : {
        						"install_trust": false
        					}
        				}
        			}
        		}
        	}
        	
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"http_port":9080,"https_port":9443,"servers":{"srv0":{"listen":[":9443"],"routes":[{"handle":[{"body":"hello from a.caddy.localhost","handler":"static_response","status_code":200}],"match":[{"path":["/version"]}]}],"tls_connection_policies":[{"certificate_selection":{"any_tag":["cert0"]},"default_sni":"a.caddy.localhost"}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}},"tls":{"certificates":{"load_files":[{"certificate":"/testbed/caddytest/a.caddy.localhost.crt","key":"/testbed/caddytest/a.caddy.localhost.key","tags":["cert0"]}]}}}}
{"level":"info","ts":1728043330.369617,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40910","headers":{"Accept-Encoding":["gzip"],"Content-Length":["632"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3706682,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043330.3716207,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [a.caddy.localhost]: no OCSP server specified in certificate"}
{"level":"info","ts":1728043330.3717542,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043330.3725052,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043330.3725407,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.373609,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.3736305,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.373656,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"error","ts":1728043330.3737516,"logger":"http","msg":"server shutdown","error":"context deadline exceeded","addresses":[":9443"]}
{"level":"info","ts":1728043330.3739302,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.3739505,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.3741179,"msg":"caddytest: config load time took 5.668846ms"}
{"level":"info","ts":1728043330.3744001,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.3752027,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40918","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3756914,"msg":"caddytest: redirecting the dialer from 127.0.0.1:9443 to 127.0.0.1:9443"}
--- PASS: TestDefaultSNIWithPortMappingOnly (0.01s)
=== RUN   TestHttpOnlyOnDomainWithSNI
    caddytest.go:415: warning: Caddyfile:1: : Caddyfile input is not formatted; run 'caddy fmt --overwrite' to fix inconsistencies
--- PASS: TestHttpOnlyOnDomainWithSNI (0.00s)
=== RUN   TestH2ToH2CStream
{"level":"info","ts":1728043330.3820612,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40918","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3835082,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40920","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before:  
          {
        	"admin": {
        		"listen": "localhost:2999"
        	},
            "apps": {
              "http": {
                "http_port": 9080,
                "https_port": 9443,
        		"grace_period": 1,
                "servers": {
                  "srv0": {
                    "listen": [
                      ":9443"
                    ],
                    "routes": [
                      {
                        "handle": [
                          {
                            "handler": "reverse_proxy",
                            "transport": {
                              "protocol": "http",
                              "compression": false,
                              "versions": [
                                "h2c",
                                "2"
                              ]
                            },
                            "upstreams": [
                              {
                                "dial": "localhost:54321"
                              }
                            ]
                          }
                        ],
                        "match": [
                          {
                            "path": [
                              "/tov2ray"
                            ]
                          }
                        ]
                      }
                    ],
                    "tls_connection_policies": [
                      {
                        "certificate_selection": {
                          "any_tag": ["cert0"]
                        },
                        "default_sni": "a.caddy.localhost"
                      }
                    ]
                  }
                }
              },
              "tls": {
                "certificates": {
                  "load_files": [
                    {
                      "certificate": "/testbed/caddytest/a.caddy.localhost.crt",
                      "key": "/testbed/caddytest/a.caddy.localhost.key",
                      "tags": [
                        "cert0"
                      ]
                    }
                  ]
                }
              },
              "pki": {
                "certificate_authorities" : {
                  "local" : {
                    "install_trust": false
                  }
                }
              }
            }
          }
          
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"http_port":9080,"https_port":9443,"servers":{"srv0":{"listen":[":9443"],"routes":[{"handle":[{"handler":"reverse_proxy","transport":{"compression":false,"protocol":"http","versions":["h2c","2"]},"upstreams":[{"dial":"localhost:54321"}]}],"match":[{"path":["/tov2ray"]}]}],"tls_connection_policies":[{"certificate_selection":{"any_tag":["cert0"]},"default_sni":"a.caddy.localhost"}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}},"tls":{"certificates":{"load_files":[{"certificate":"/testbed/caddytest/a.caddy.localhost.crt","key":"/testbed/caddytest/a.caddy.localhost.key","tags":["cert0"]}]}}}}
{"level":"info","ts":1728043330.3860724,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40922","headers":{"Accept-Encoding":["gzip"],"Content-Length":["690"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3875353,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043330.388843,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [a.caddy.localhost]: no OCSP server specified in certificate"}
{"level":"info","ts":1728043330.3891091,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"info","ts":1728043330.3904018,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.39064,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"info","ts":1728043330.3906991,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.3907897,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.3908129,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"error","ts":1728043330.3909194,"logger":"http","msg":"server shutdown","error":"context deadline exceeded","addresses":[":9443"]}
{"level":"info","ts":1728043330.3910944,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.3911138,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.3912475,"msg":"caddytest: config load time took 6.530918ms"}
{"level":"info","ts":1728043330.3912659,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.3921144,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40926","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.3925447,"msg":"caddytest: redirecting the dialer from 127.0.0.1:9443 to 127.0.0.1:9443"}
    stream_test.go:157: h2c server received req: PUT /tov2ray HTTP/2.0
        Host: 127.0.0.1:9443
        Accept-Encoding: identity
        User-Agent: Go-http-client/2.0
        X-Forwarded-For: 127.0.0.1
        X-Forwarded-Host: 127.0.0.1:9443
        X-Forwarded-Proto: https
        
--- PASS: TestH2ToH2CStream (0.02s)
=== RUN   TestH2ToH1ChunkedResponse
{"level":"info","ts":1728043330.4011445,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40926","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.4019523,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40942","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
    caddytest.go:141: Before:  
        {
        	"admin": {
        		"listen": "localhost:2999"
        	},
          "logging": {
            "logs": {
              "default": {
                "level": "DEBUG"
              }
            }
          },
          "apps": {
            "http": {
              "http_port": 9080,
              "https_port": 9443,
        	  "grace_period": 1,
              "servers": {
                "srv0": {
                  "listen": [
                    ":9443"
                  ],
                  "routes": [
                    {
                      "handle": [
                        {
                          "handler": "subroute",
                          "routes": [
                            {
                              "handle": [
                                {
                                  "encodings": {
                                    "gzip": {}
                                  },
                                  "handler": "encode"
                                }
                              ]
                            },
                            {
                              "handle": [
                                {
                                  "handler": "reverse_proxy",
                                  "upstreams": [
                                    {
                                      "dial": "localhost:54321"
                                    }
                                  ]
                                }
                              ],
                              "match": [
                                {
                                  "path": [
                                    "/tov2ray"
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "terminal": true
                    }
                  ],
                  "tls_connection_policies": [
                    {
                      "certificate_selection": {
                        "any_tag": [
                          "cert0"
                        ]
                      },
                      "default_sni": "a.caddy.localhost"
                    }
                  ]
                }
              }
            },
            "tls": {
              "certificates": {
                "load_files": [
                  {
                    "certificate": "/testbed/caddytest/a.caddy.localhost.crt",
                    "key": "/testbed/caddytest/a.caddy.localhost.key",
                    "tags": [
                      "cert0"
                    ]
                  }
                ]
              }
            },
            "pki": {
              "certificate_authorities": {
                "local": {
                  "install_trust": false
                }
              }
            }
          }
        }
          
    caddytest.go:151: After: {"admin":{"listen":"localhost:2999"},"apps":{"http":{"grace_period":1,"http_port":9080,"https_port":9443,"servers":{"srv0":{"listen":[":9443"],"routes":[{"handle":[{"handler":"subroute","routes":[{"handle":[{"encodings":{"gzip":{}},"handler":"encode"}]},{"handle":[{"handler":"reverse_proxy","upstreams":[{"dial":"localhost:54321"}]}],"match":[{"path":["/tov2ray"]}]}]}],"terminal":true}],"tls_connection_policies":[{"certificate_selection":{"any_tag":["cert0"]},"default_sni":"a.caddy.localhost"}]}}},"pki":{"certificate_authorities":{"local":{"install_trust":false}}},"tls":{"certificates":{"load_files":[{"certificate":"/testbed/caddytest/a.caddy.localhost.crt","key":"/testbed/caddytest/a.caddy.localhost.key","tags":["cert0"]}]}}},"logging":{"logs":{"default":{"level":"DEBUG"}}}}
{"level":"info","ts":1728043330.4034455,"logger":"admin.api","msg":"received request","method":"POST","host":"localhost:2999","uri":"/load","remote_ip":"127.0.0.1","remote_port":"40952","headers":{"Accept-Encoding":["gzip"],"Content-Length":["785"],"Content-Type":["application/json"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.404421,"logger":"admin","msg":"admin endpoint started","address":"localhost:2999","enforce_origin":false,"origins":["//localhost:2999","//[::1]:2999","//127.0.0.1:2999"]}
{"level":"warn","ts":1728043330.4056163,"logger":"tls","msg":"stapling OCSP","error":"no OCSP stapling for [a.caddy.localhost]: no OCSP server specified in certificate"}
{"level":"debug","ts":1728043330.4056695,"logger":"events","msg":"event","name":"cached_unmanaged_cert","id":"b69be174-ffce-41de-b87a-c61d9a695956","origin":"tls","data":{"sans":["a.caddy.localhost"]}}
{"level":"info","ts":1728043330.4057813,"logger":"http.auto_https","msg":"enabling automatic HTTP->HTTPS redirects","server_name":"srv0"}
{"level":"debug","ts":1728043330.4058244,"logger":"http.auto_https","msg":"adjusted config","tls":{"automation":{"policies":[{}]}},"http":{"http_port":9080,"https_port":9443,"grace_period":1,"servers":{"remaining_auto_https_redirects":{"listen":[":9080"],"routes":[{},{}]},"srv0":{"listen":[":9443"],"routes":[{"handle":[{"handler":"subroute","routes":[{"handle":[{"encodings":{"gzip":{}},"handler":"encode"}]},{"handle":[{"handler":"reverse_proxy","upstreams":[{"dial":"localhost:54321"}]}],"match":[{"path":["/tov2ray"]}]}]}],"terminal":true}],"tls_connection_policies":[{"certificate_selection":{"any_tag":["cert0"]},"default_sni":"a.caddy.localhost"}],"automatic_https":{}}}}}
{"level":"info","ts":1728043330.4061422,"logger":"pki.ca.local","msg":"root certificate trust store installation disabled; unconfigured clients may show warnings","path":"storage:pki/authorities/local/root.crt"}
{"level":"info","ts":1728043330.4062364,"logger":"http","msg":"enabling HTTP/3 listener","addr":":9443"}
{"level":"debug","ts":1728043330.4062564,"logger":"http","msg":"starting server loop","address":"[::]:9443","tls":true,"http3":true}
{"level":"info","ts":1728043330.4062655,"logger":"http.log","msg":"server running","name":"srv0","protocols":["h1","h2","h3"]}
{"level":"debug","ts":1728043330.4063096,"logger":"http","msg":"starting server loop","address":"[::]:9080","tls":false,"http3":false}
{"level":"info","ts":1728043330.4063163,"logger":"http.log","msg":"server running","name":"remaining_auto_https_redirects","protocols":["h1","h2","h3"]}
{"level":"info","ts":1728043330.4063303,"logger":"http","msg":"servers shutting down; grace period initiated","duration":0.000000001}
{"level":"error","ts":1728043330.4064658,"logger":"http","msg":"server shutdown","error":"context deadline exceeded","addresses":[":9443"]}
{"level":"info","ts":1728043330.4067113,"msg":"autosaved config (load with --resume flag)","file":"/root/.config/caddy/autosave.json"}
{"level":"info","ts":1728043330.406727,"logger":"admin.api","msg":"load complete"}
{"level":"info","ts":1728043330.4070377,"msg":"caddytest: config load time took 4.462473ms"}
{"level":"info","ts":1728043330.4080994,"logger":"admin","msg":"stopped previous server","address":"localhost:2999"}
{"level":"info","ts":1728043330.408395,"logger":"admin.api","msg":"received request","method":"GET","host":"localhost:2999","uri":"/config/","remote_ip":"127.0.0.1","remote_port":"40964","headers":{"Accept-Encoding":["gzip"],"User-Agent":["Go-http-client/1.1"]}}
{"level":"info","ts":1728043330.4089956,"msg":"caddytest: redirecting the dialer from 127.0.0.1:9443 to 127.0.0.1:9443"}
{"level":"debug","ts":1728043330.4100513,"logger":"events","msg":"event","name":"tls_get_certificate","id":"4f98d706-ab45-4693-bd54-ec2d363763ba","origin":"tls","data":{"client_hello":{"CipherSuites":[49195,49199,49196,49200,52393,52392,49161,49171,49162,49172,156,157,47,53,49170,10,4865,4866,4867],"ServerName":"","SupportedCurves":[29,23,24,25],"SupportedPoints":"AA==","SignatureSchemes":[2052,1027,2055,2053,2054,1025,1281,1537,1283,1539,513,515],"SupportedProtos":["h2","http/1.1"],"SupportedVersions":[772,771],"RemoteAddr":{"IP":"127.0.0.1","Port":51912,"Zone":""},"LocalAddr":{"IP":"127.0.0.1","Port":9443,"Zone":""}}}}
{"level":"debug","ts":1728043330.410079,"logger":"tls.handshake","msg":"no matching certificate; will choose from all certificates","identifier":"127.0.0.1"}
{"level":"debug","ts":1728043330.4100873,"logger":"tls.handshake","msg":"choosing certificate","identifier":"127.0.0.1","num_choices":1}
{"level":"debug","ts":1728043330.410101,"logger":"tls.handshake","msg":"custom certificate selection results","identifier":"127.0.0.1","subjects":["a.caddy.localhost"],"managed":false,"issuer_key":"","hash":"205fb33c3301100a987798c3f0831eecbecb8143dde9796d253e7a8c23722e67"}
{"level":"debug","ts":1728043330.4101114,"logger":"tls.handshake","msg":"matched certificate in cache","remote_ip":"127.0.0.1","remote_port":"51912","subjects":["a.caddy.localhost"],"managed":false,"expiration":1899485418,"hash":"205fb33c3301100a987798c3f0831eecbecb8143dde9796d253e7a8c23722e67"}
{"level":"debug","ts":1728043330.4143152,"logger":"http.handlers.reverse_proxy","msg":"selected upstream","dial":"localhost:54321","total_upstreams":1}
{"level":"debug","ts":1728043330.4160693,"logger":"http.handlers.reverse_proxy","msg":"upstream roundtrip","upstream":"localhost:54321","duration":0.001691993,"request":{"remote_ip":"127.0.0.1","remote_port":"51912","client_ip":"127.0.0.1","proto":"HTTP/2.0","method":"PUT","host":"127.0.0.1:9443","uri":"/tov2ray","headers":{"Accept-Encoding":["gzip"],"X-Forwarded-For":["127.0.0.1"],"X-Forwarded-Proto":["https"],"X-Forwarded-Host":["127.0.0.1:9443"],"User-Agent":["Go-http-client/2.0"]},"tls":{"resumed":false,"version":772,"cipher_suite":4865,"proto":"h2","server_name":""}},"headers":{"Content-Encoding":["gzip"],"Date":["Fri, 04 Oct 2024 12:02:10 GMT"],"Content-Length":["818"]},"status":200}
--- PASS: TestH2ToH1ChunkedResponse (0.02s)
PASS
ok  	github.com/caddyserver/caddy/v2/caddytest/integration	6.972s
+ git checkout f6d2c293e752254769efe21c8d06a16ebad4845e
HEAD is now at f6d2c293 caddyfile: Reject global request matchers earlier (#6339)
M	modules/caddypki/acmeserver/caddyfile.go
